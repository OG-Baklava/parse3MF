{"version":3,"sources":["../src/core/analyzer.ts","../src/core/parser.ts","../src/core/exporter.ts","../src/react/context.tsx","../src/styles/theme.ts","../src/react/Viewer.tsx","../src/react/ColorPicker.tsx","../src/react/PlateSelector.tsx","../src/react/SaveButton.tsx","../src/react/Workbench.tsx"],"names":["Vector3","JSZip","BufferGeometry","BufferAttribute","normalizeColor","slotNorm","createContext","useReducer","useRef","useCallback","useEffect","jsx","useContext","THREE","useState","useMemo","OrbitControls","mesh","jsxs","Fragment"],"mappings":"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","file":"index.cjs","sourcesContent":["import { BufferGeometry, Vector3 } from 'three'\nimport type { BoundingBox } from './types'\n\n/**\n * Calculate volume of a BufferGeometry using the signed-tetrahedron method.\n * @returns Volume in cm (assumes model units are mm).\n */\nexport function calculateVolume(geometry: BufferGeometry): number {\n  const position = geometry.attributes.position\n  if (!position) throw new Error('Geometry has no position attribute')\n\n  let volume = 0\n  const index = geometry.index\n\n  if (index) {\n    const arr = index.array as Uint32Array | Uint16Array\n    for (let i = 0; i < index.count; i += 3) {\n      volume += signedVolumeOfTriangle(\n        new Vector3(position.getX(arr[i]), position.getY(arr[i]), position.getZ(arr[i])),\n        new Vector3(position.getX(arr[i + 1]), position.getY(arr[i + 1]), position.getZ(arr[i + 1])),\n        new Vector3(position.getX(arr[i + 2]), position.getY(arr[i + 2]), position.getZ(arr[i + 2])),\n      )\n    }\n  } else {\n    for (let i = 0; i < position.count; i += 3) {\n      volume += signedVolumeOfTriangle(\n        new Vector3(position.getX(i), position.getY(i), position.getZ(i)),\n        new Vector3(position.getX(i + 1), position.getY(i + 1), position.getZ(i + 1)),\n        new Vector3(position.getX(i + 2), position.getY(i + 2), position.getZ(i + 2)),\n      )\n    }\n  }\n\n  // mm  cm\n  return Math.abs(volume) / 1000\n}\n\nfunction signedVolumeOfTriangle(p1: Vector3, p2: Vector3, p3: Vector3): number {\n  return p1.dot(p2.cross(p3)) / 6.0\n}\n\n/**\n * Calculate bounding-box dimensions.\n * @returns { x, y, z } in mm.\n */\nexport function calculateBoundingBox(geometry: BufferGeometry): BoundingBox {\n  geometry.computeBoundingBox()\n  const box = geometry.boundingBox\n  if (!box) throw new Error('Failed to compute bounding box')\n  const size = new Vector3()\n  box.getSize(size)\n  return {\n    x: Number(size.x.toFixed(2)),\n    y: Number(size.y.toFixed(2)),\n    z: Number(size.z.toFixed(2)),\n  }\n}\n","/**\n * 3MF Parser  spec-compliant implementation (v2.7)\n *\n * Multicolor detection paths (checked in order):\n *  1. XML colorgroups/basematerials with triangle-level pid/p1 (standard 3MF)\n *  2. Bambu Studio: filament colors from JSON project_settings.config\n *  3. Bambu Studio: per-object/part extruder assignments from model_settings.config\n *  4. Bambu Studio: paint_color hex attributes on <triangle> elements (per-tri painting)\n *  5. Bambu Studio: filament count from JSON array lengths (e.g. 3-entry arrays = 3 filaments)\n *  6. PrusaSlicer: volume triangle ranges + per-volume extruder assignments\n *  7. Component-level pid/pindex from main model applied to external objects\n *  8. External object ID remapping with composite map fixup\n *\n * @packageDocumentation\n */\n\nimport { BufferGeometry, BufferAttribute } from 'three'\nimport type { ParsedThreeMF, MaterialSlot, Plate, ParsedTriangle, ParsedGeomObject } from './types'\nimport { calculateVolume, calculateBoundingBox } from './analyzer'\nimport JSZip from 'jszip'\n\n// ---------------------------------------------------------------------------\n// Errors\n// ---------------------------------------------------------------------------\n\n/** Thrown when a 3MF file cannot be parsed. */\nexport class ThreeMFParseError extends Error {\n  constructor(message: string) {\n    super(message)\n    this.name = 'ThreeMFParseError'\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Internal Types\n// ---------------------------------------------------------------------------\n\ninterface PropertyResource {\n  id: string\n  type: 'basematerials' | 'colorgroup'\n  colors: string[]\n  names?: string[]\n}\n\ninterface BuildItem {\n  objectId: number\n  transform?: string\n}\n\ninterface ComponentRef {\n  objectId: number\n  path?: string\n  pid?: string\n  pindex?: number\n}\n\n// ---------------------------------------------------------------------------\n// XML Helper\n// ---------------------------------------------------------------------------\n\nfunction findElements(container: Document | Element, localName: string): Element[] {\n  const found = new Set<Element>()\n  const lowerName = localName.toLowerCase()\n\n  try {\n    container.querySelectorAll(localName).forEach(el => found.add(el))\n  } catch { /* ignore */ }\n\n  const allElements = container.getElementsByTagName('*')\n  for (let i = 0; i < allElements.length; i++) {\n    const elem = allElements[i]\n    const elemLocal = (elem.localName || '').toLowerCase()\n    const tagLower = elem.tagName.toLowerCase()\n    if (elemLocal === lowerName || tagLower === lowerName || tagLower.endsWith(':' + lowerName)) {\n      found.add(elem)\n    }\n  }\n\n  return Array.from(found)\n}\n\nfunction normalizeColor(color: string): string {\n  if (!color || color.trim() === '') return '#808080'\n  let c = color.trim()\n  if (!c.startsWith('#')) c = '#' + c\n  if (c.length === 9) c = c.substring(0, 7) // strip alpha\n  return c.toUpperCase()\n}\n\n// ---------------------------------------------------------------------------\n// Resource Parsing\n// ---------------------------------------------------------------------------\n\nfunction parseResources(xmlDoc: Document | Element): Map<string, PropertyResource> {\n  const resources = new Map<string, PropertyResource>()\n\n  for (const bmElem of findElements(xmlDoc, 'basematerials')) {\n    const id = bmElem.getAttribute('id') || bmElem.getAttribute('Id') || ''\n    if (!id) continue\n    const colors: string[] = []\n    const names: string[] = []\n    for (const base of findElements(bmElem, 'base')) {\n      colors.push(normalizeColor(base.getAttribute('displaycolor') || base.getAttribute('DisplayColor') || ''))\n      names.push(base.getAttribute('name') || base.getAttribute('Name') || '')\n    }\n    if (colors.length > 0) resources.set(id, { id, type: 'basematerials', colors, names })\n  }\n\n  for (const cgElem of findElements(xmlDoc, 'colorgroup')) {\n    const id = cgElem.getAttribute('id') || cgElem.getAttribute('Id') || ''\n    if (!id) continue\n    const colors: string[] = []\n    for (const colorElem of findElements(cgElem, 'color')) {\n      const c = colorElem.getAttribute('color') || colorElem.getAttribute('Color') || ''\n      if (c) colors.push(normalizeColor(c))\n    }\n    if (colors.length > 0) resources.set(id, { id, type: 'colorgroup', colors })\n  }\n\n  return resources\n}\n\nfunction resolveColor(\n  pid: string | null | undefined,\n  pindex: number,\n  resources: Map<string, PropertyResource>,\n): string | null {\n  if (!pid) return null\n  const resource = resources.get(pid)\n  if (!resource) return null\n  if (pindex < 0 || pindex >= resource.colors.length) return null\n  return resource.colors[pindex]\n}\n\n// ---------------------------------------------------------------------------\n// Object Parsing\n// ---------------------------------------------------------------------------\n\nfunction parseGeometryObjects(\n  xmlDoc: Document | Element,\n  resources: Map<string, PropertyResource>,\n  defaultColor?: string | null,\n): ParsedGeomObject[] {\n  const objects: ParsedGeomObject[] = []\n\n  for (const objElem of findElements(xmlDoc, 'object')) {\n    const type = objElem.getAttribute('type')\n    if (type && type !== 'model') continue\n\n    const id = parseInt(objElem.getAttribute('id') || '0')\n    const name = objElem.getAttribute('name') || objElem.getAttribute('Name') || `Object ${id}`\n\n    const objPid = objElem.getAttribute('pid') || null\n    const objPindexStr = objElem.getAttribute('pindex')\n    const objPindex = objPindexStr !== null ? parseInt(objPindexStr) : 0\n    const objDefaultColor = resolveColor(objPid, objPindex, resources) || defaultColor || null\n\n    const meshElems = findElements(objElem, 'mesh')\n    if (meshElems.length === 0) continue\n\n    const meshElem = meshElems[0]\n    const vertices: number[] = []\n    for (const v of findElements(meshElem, 'vertex')) {\n      vertices.push(\n        parseFloat(v.getAttribute('x') || '0'),\n        parseFloat(v.getAttribute('y') || '0'),\n        parseFloat(v.getAttribute('z') || '0'),\n      )\n    }\n    if (vertices.length === 0) continue\n\n    const triangles: ParsedTriangle[] = []\n    for (const t of findElements(meshElem, 'triangle')) {\n      const v1 = parseInt(t.getAttribute('v1') || '0')\n      const v2 = parseInt(t.getAttribute('v2') || '0')\n      const v3 = parseInt(t.getAttribute('v3') || '0')\n\n      const triPid = t.getAttribute('pid') || null\n      const p1Str = t.getAttribute('p1')\n      let colorHex: string | null = null\n\n      if (triPid && p1Str !== null) {\n        colorHex = resolveColor(triPid, parseInt(p1Str), resources)\n      } else if (triPid) {\n        colorHex = resolveColor(triPid, 0, resources)\n      }\n      if (!colorHex && objDefaultColor) colorHex = objDefaultColor\n\n      // Read BambuStudio paint_color / mmu_segmentation attribute\n      let paintAttr =\n        t.getAttribute('paint_color') ||\n        t.getAttribute('slic3rpe:mmu_segmentation') ||\n        t.getAttribute('mmu_segmentation') ||\n        null\n      if (!paintAttr) {\n        for (let ai = 0; ai < t.attributes.length; ai++) {\n          const aName = t.attributes[ai].name.toLowerCase()\n          if (aName.includes('paint_color') || aName.includes('mmu_segmentation')) {\n            paintAttr = t.attributes[ai].value\n            break\n          }\n        }\n      }\n\n      triangles.push({ v1, v2, v3, colorHex, paintAttr: paintAttr || undefined })\n    }\n\n    if (vertices.length > 0 && triangles.length > 0) {\n      objects.push({ id, name, vertices, triangles })\n    }\n  }\n\n  return objects\n}\n\nfunction parseComponents(objElem: Element): ComponentRef[] {\n  const components: ComponentRef[] = []\n  const seen = new Set<Element>()\n\n  const compElems = [\n    ...Array.from(objElem.querySelectorAll('components > component')),\n    ...findElements(objElem, 'component'),\n  ]\n\n  for (const comp of compElems) {\n    if (seen.has(comp)) continue\n    seen.add(comp)\n\n    const objectId = parseInt(comp.getAttribute('objectid') || '0')\n    if (objectId <= 0) continue\n\n    let path: string | undefined\n    for (let i = 0; i < comp.attributes.length; i++) {\n      const attr = comp.attributes[i]\n      if (attr.localName === 'path' || attr.name.endsWith(':path')) {\n        path = attr.value\n        break\n      }\n    }\n\n    const pid = comp.getAttribute('pid') || undefined\n    const pindex = pid ? parseInt(comp.getAttribute('pindex') || '0') : undefined\n\n    components.push({ objectId, path, pid, pindex })\n  }\n\n  return components\n}\n\n// ---------------------------------------------------------------------------\n// Bambu Studio / Slicer Metadata\n// ---------------------------------------------------------------------------\n\nasync function extractFilamentColors(\n  zipContent: JSZip,\n): Promise<{ colors: string[]; filamentCount: number }> {\n  let filamentCount = 0\n\n  // Source 1: project_settings.config (JSON in Bambu Studio)\n  for (const path of ['Metadata/project_settings.config', 'Metadata/Project_settings.config']) {\n    const file = zipContent.file(path)\n    if (!file) continue\n    try {\n      const content = await file.async('text')\n      const trimmed = content.trim()\n\n      if (trimmed.startsWith('{')) {\n        try {\n          const json = JSON.parse(trimmed)\n          for (const key of Object.keys(json)) {\n            if (Array.isArray(json[key]) && json[key].length > 1) {\n              filamentCount = Math.max(filamentCount, json[key].length)\n            }\n          }\n\n          const colorKey = Object.keys(json).find(\n            (k) => k.toLowerCase() === 'filament_colour' || k.toLowerCase() === 'filament_color',\n          )\n\n          if (colorKey) {\n            let rawColors: string[] = []\n            const val = json[colorKey]\n            if (Array.isArray(val)) {\n              rawColors = val.map((c: string) => String(c).trim()).filter((c: string) => c.length > 0)\n            } else if (typeof val === 'string') {\n              rawColors = val\n                .split(';')\n                .map((c: string) => c.trim())\n                .filter((c: string) => c.length > 0)\n            }\n            const colors = rawColors.map((c) => normalizeColor(c))\n            if (colors.length > 0)\n              return { colors, filamentCount: Math.max(filamentCount, colors.length) }\n          }\n\n          if (filamentCount > 1) return { colors: [], filamentCount }\n        } catch {\n          /* try INI fallback */\n        }\n      }\n\n      const match = content.match(/filament_colou?r\\s*=\\s*(.+)/i)\n      if (match) {\n        const raw = match[1]\n          .split(';')\n          .map((c) => c.trim())\n          .filter((c) => c.length > 0)\n        const colors = raw.map((c) => normalizeColor(c))\n        if (colors.length > 0) return { colors, filamentCount: Math.max(filamentCount, colors.length) }\n      }\n    } catch {\n      /* ignore */\n    }\n  }\n\n  // Source 2: slice_info.config\n  const sliceInfoFile = zipContent.file('Metadata/slice_info.config')\n  if (sliceInfoFile) {\n    try {\n      const content = await sliceInfoFile.async('text')\n      const parser = new DOMParser()\n      const doc = parser.parseFromString(content, 'text/xml')\n      const colors: string[] = []\n      for (const f of findElements(doc, 'filament')) {\n        const c = f.getAttribute('color') || f.getAttribute('Color') || ''\n        if (c && c.trim()) colors.push(normalizeColor(c))\n      }\n      const unique = [...new Set(colors)]\n      if (unique.length > 0) return { colors: unique, filamentCount: Math.max(filamentCount, unique.length) }\n    } catch {\n      /* ignore */\n    }\n  }\n\n  // Source 3: Any other .config file\n  const configFiles = Object.keys(zipContent.files).filter(\n    (f) => f.endsWith('.config') && !f.includes('model_settings'),\n  )\n  for (const path of configFiles) {\n    try {\n      const content = await zipContent.file(path)?.async('text')\n      if (!content) continue\n      const trimmed = content.trim()\n      if (trimmed.startsWith('{')) {\n        try {\n          const json = JSON.parse(trimmed)\n          const colorKey = Object.keys(json).find(\n            (k) => k.toLowerCase() === 'filament_colour' || k.toLowerCase() === 'filament_color',\n          )\n          if (colorKey) {\n            let rawColors: string[] = []\n            const val = json[colorKey]\n            if (Array.isArray(val)) {\n              rawColors = val.map((c: string) => String(c).trim()).filter((c: string) => c.length > 0)\n            } else if (typeof val === 'string') {\n              rawColors = val.split(';').map((c: string) => c.trim()).filter((c: string) => c.length > 0)\n            }\n            const colors = rawColors.map((c) => normalizeColor(c))\n            if (colors.length > 0) return { colors, filamentCount: Math.max(filamentCount, colors.length) }\n          }\n        } catch {\n          /* ignore */\n        }\n      }\n      const match = content.match(/filament_colou?r\\s*=\\s*(.+)/i)\n      if (match) {\n        const raw = match[1].split(';').map((c) => c.trim()).filter((c) => c.length > 0)\n        const colors = raw.map((c) => normalizeColor(c))\n        if (colors.length > 0) return { colors, filamentCount: Math.max(filamentCount, colors.length) }\n      }\n    } catch {\n      /* ignore */\n    }\n  }\n\n  return { colors: [], filamentCount }\n}\n\nasync function parseModelSettings(\n  zipContent: JSZip,\n): Promise<{\n  objectExtruderMap: Map<number, number>\n  hasMmuSegmentation: boolean\n  distinctExtruders: Set<number>\n}> {\n  const objectExtruderMap = new Map<number, number>()\n  let hasMmuSegmentation = false\n  const distinctExtruders = new Set<number>()\n\n  const modelSettingsFile = zipContent.file('Metadata/model_settings.config')\n  if (!modelSettingsFile) return { objectExtruderMap, hasMmuSegmentation, distinctExtruders }\n\n  try {\n    const content = await modelSettingsFile.async('text')\n    const parser = new DOMParser()\n    const configDoc = parser.parseFromString(content, 'text/xml')\n    const configObjects = findElements(configDoc, 'object')\n\n    for (const obj of configObjects) {\n      const objId = parseInt(obj.getAttribute('id') || '0')\n      if (objId <= 0) continue\n\n      const allObjMeta = new Map<string, string>()\n      const partMeta = new Set<Element>()\n\n      const parts = findElements(obj, 'part')\n      for (const part of parts) {\n        for (const meta of findElements(part, 'metadata')) {\n          partMeta.add(meta)\n          const key = meta.getAttribute('key') || ''\n          const value = meta.getAttribute('value') || meta.textContent?.trim() || ''\n          if (key === 'mmu_segmentation' && value.length > 0) hasMmuSegmentation = true\n        }\n      }\n\n      for (const meta of findElements(obj, 'metadata')) {\n        if (partMeta.has(meta)) continue\n        const key = meta.getAttribute('key') || ''\n        const value = meta.getAttribute('value') || meta.textContent?.trim() || ''\n        allObjMeta.set(key, value)\n        if (key === 'mmu_segmentation' && value.length > 0) hasMmuSegmentation = true\n      }\n\n      // Process parts (most specific)\n      for (const part of parts) {\n        const subObjId = parseInt(part.getAttribute('sub_object_id') || '0')\n        const partIdAttr = parseInt(part.getAttribute('id') || '0')\n        const targetId = subObjId || partIdAttr\n\n        const partMetaMap = new Map<string, string>()\n        for (const meta of findElements(part, 'metadata')) {\n          const key = meta.getAttribute('key') || ''\n          const value = meta.getAttribute('value') || meta.textContent?.trim() || ''\n          partMetaMap.set(key, value)\n        }\n\n        // Check child elements\n        for (const childTag of ['paint_color', 'mmu_segmentation']) {\n          if (findElements(part, childTag).length > 0) hasMmuSegmentation = true\n        }\n\n        if (targetId <= 0) continue\n\n        const extruderStr = partMetaMap.get('extruder')\n        if (extruderStr !== undefined) {\n          const extruder = parseInt(extruderStr)\n          if (!isNaN(extruder) && extruder >= 0) {\n            const effectiveExtruder = extruder === 0 ? 1 : extruder\n            objectExtruderMap.set(targetId, effectiveExtruder)\n            distinctExtruders.add(effectiveExtruder)\n          }\n        }\n      }\n\n      // Object-level extruder (fallback)\n      const objExtruderStr = allObjMeta.get('extruder')\n      if (objExtruderStr !== undefined) {\n        const objExtruder = parseInt(objExtruderStr)\n        if (!isNaN(objExtruder) && objExtruder >= 0) {\n          const effectiveExtruder = objExtruder === 0 ? 1 : objExtruder\n          if (!objectExtruderMap.has(objId)) {\n            objectExtruderMap.set(objId, effectiveExtruder)\n            distinctExtruders.add(effectiveExtruder)\n          }\n          for (const part of parts) {\n            const subObjId = parseInt(part.getAttribute('sub_object_id') || '0')\n            const partIdAttr = parseInt(part.getAttribute('id') || '0')\n            const targetId = subObjId || partIdAttr\n            if (targetId > 0 && !objectExtruderMap.has(targetId)) {\n              objectExtruderMap.set(targetId, effectiveExtruder)\n              distinctExtruders.add(effectiveExtruder)\n            }\n          }\n        }\n      }\n    }\n\n    return { objectExtruderMap, hasMmuSegmentation, distinctExtruders }\n  } catch {\n    return { objectExtruderMap, hasMmuSegmentation, distinctExtruders }\n  }\n}\n\nasync function parseBambuPlates(\n  zipContent: JSZip,\n): Promise<{ plates: Plate[]; plateObjectMap: Map<number, number[]> }> {\n  const plates: Plate[] = []\n  const plateObjectMap = new Map<number, number[]>()\n\n  const plateFiles = Object.keys(zipContent.files)\n    .filter((f) => /Metadata\\/plate_\\d+\\.json/i.test(f))\n    .sort()\n\n  if (plateFiles.length > 0) {\n    for (const platePath of plateFiles) {\n      try {\n        const content = await zipContent.file(platePath)?.async('text')\n        if (!content) continue\n        const plateData = JSON.parse(content)\n        const plateNum = parseInt(platePath.match(/plate_(\\d+)/)?.[1] || '0')\n        if (plateNum <= 0) continue\n\n        const objectIds: number[] = []\n        if (Array.isArray(plateData)) {\n          plateData.forEach((item: any) => {\n            if (item.id !== undefined) objectIds.push(item.id)\n          })\n        } else if (plateData.objects) {\n          plateData.objects.forEach((item: any) => {\n            if (item.id !== undefined) objectIds.push(item.id)\n          })\n        }\n\n        plates.push({ id: plateNum, name: `Plate ${plateNum}`, objectIds })\n        plateObjectMap.set(plateNum, objectIds)\n      } catch {\n        /* ignore */\n      }\n    }\n  }\n\n  if (plates.length === 0) {\n    const filamentSeqFile = zipContent.file('Metadata/filament_sequence.json')\n    if (filamentSeqFile) {\n      try {\n        const content = await filamentSeqFile.async('text')\n        const seq = JSON.parse(content)\n        const plateKeys = Object.keys(seq).filter((k) => k.startsWith('plate_'))\n        for (const key of plateKeys) {\n          const plateNum = parseInt(key.replace('plate_', '')) || 0\n          if (plateNum > 0) {\n            plates.push({ id: plateNum, name: `Plate ${plateNum}`, objectIds: [] })\n            plateObjectMap.set(plateNum, [])\n          }\n        }\n      } catch {\n        /* ignore */\n      }\n    }\n  }\n\n  return { plates, plateObjectMap }\n}\n\nasync function parsePrusaSlicerMetadata(\n  zipContent: JSZip,\n): Promise<{\n  volumeRanges: Array<{ firstid: number; lastid: number; extruder: number }>\n  extruderColors: string[]\n}> {\n  const volumeRanges: Array<{ firstid: number; lastid: number; extruder: number }> = []\n  const extruderColors: string[] = []\n\n  const configFiles = Object.keys(zipContent.files).filter(\n    (f) => f.includes('Slic3r') && f.endsWith('.config'),\n  )\n  if (configFiles.length === 0) return { volumeRanges, extruderColors }\n\n  const modelConfigFile = configFiles.find((f) => f.includes('model'))\n  if (modelConfigFile) {\n    try {\n      const content = await zipContent.file(modelConfigFile)?.async('text')\n      if (content) {\n        const parser = new DOMParser()\n        const configDoc = parser.parseFromString(content, 'text/xml')\n        configDoc.querySelectorAll('volume').forEach((volume) => {\n          const firstid = parseInt(volume.getAttribute('firstid') || '-1')\n          const lastid = parseInt(volume.getAttribute('lastid') || '-1')\n          if (firstid < 0 || lastid < 0) return\n          let extruder = 1\n          for (const meta of Array.from(volume.querySelectorAll('metadata'))) {\n            if (meta.getAttribute('key') === 'extruder') {\n              extruder = parseInt(meta.getAttribute('value') || meta.textContent || '1')\n            }\n          }\n          volumeRanges.push({ firstid, lastid, extruder })\n        })\n      }\n    } catch {\n      /* ignore */\n    }\n  }\n\n  for (const configFile of configFiles) {\n    if (configFile === modelConfigFile) continue\n    try {\n      const content = await zipContent.file(configFile)?.async('text')\n      if (!content) continue\n      const match = content.match(/extruder_colou?r\\s*=\\s*(.+)/i)\n      if (match) {\n        extruderColors.push(...match[1].split(';').map((c) => normalizeColor(c.trim())))\n        break\n      }\n    } catch {\n      /* ignore */\n    }\n  }\n\n  return { volumeRanges, extruderColors }\n}\n\n// ---------------------------------------------------------------------------\n// Paint Color / MMU Segmentation Decoder\n// ---------------------------------------------------------------------------\n\nfunction paintHexToBits(hexStr: string): number[] {\n  const bits: number[] = []\n  for (let i = hexStr.length - 1; i >= 0; i--) {\n    const ch = hexStr.charCodeAt(i)\n    let dec = 0\n    if (ch >= 48 && ch <= 57) dec = ch - 48\n    else if (ch >= 65 && ch <= 70) dec = 10 + ch - 65\n    else if (ch >= 97 && ch <= 102) dec = 10 + ch - 97\n    for (let b = 0; b < 4; b++) bits.push((dec >> b) & 1)\n  }\n  return bits\n}\n\nfunction decodePaintTreeNode(bits: number[], pos: { i: number }, depth: number): number {\n  if (pos.i + 1 >= bits.length || depth > 20) return 0\n\n  const splitSides = bits[pos.i] + bits[pos.i + 1] * 2\n  pos.i += 2\n\n  if (splitSides > 0) {\n    if (pos.i + 1 >= bits.length) return 0\n    pos.i += 2 // skip special_side\n\n    const childStates: number[] = []\n    for (let c = splitSides; c >= 0; c--) {\n      childStates.push(decodePaintTreeNode(bits, pos, depth + 1))\n    }\n\n    const counts = new Map<number, number>()\n    for (const s of childStates) {\n      if (s > 0) counts.set(s, (counts.get(s) || 0) + 1)\n    }\n    let best = 0,\n      bestCount = 0\n    counts.forEach((count, state) => {\n      if (count > bestCount) {\n        bestCount = count\n        best = state\n      }\n    })\n    return best\n  } else {\n    if (pos.i + 1 >= bits.length) return 0\n    const xx = bits[pos.i] + bits[pos.i + 1] * 2\n    pos.i += 2\n\n    if (xx < 3) return xx\n\n    let n = 0\n    while (pos.i + 3 < bits.length) {\n      let nibble = 0\n      for (let b = 0; b < 4; b++) nibble |= bits[pos.i + b] << b\n      pos.i += 4\n      if (nibble === 15) {\n        n += 15\n      } else {\n        n += nibble\n        break\n      }\n    }\n    return 3 + n\n  }\n}\n\nfunction decodePaintColorAttr(hexStr: string): number {\n  if (!hexStr || hexStr.length === 0) return 0\n  const bits = paintHexToBits(hexStr)\n  const pos = { i: 0 }\n  return decodePaintTreeNode(bits, pos, 0)\n}\n\n// ---------------------------------------------------------------------------\n// Main Parser\n// ---------------------------------------------------------------------------\n\n/**\n * Parse a `.3MF` file into geometry, colors, plates, and material slots.\n *\n * Works with files exported from **Bambu Studio**, **PrusaSlicer**, **Cura**,\n * and any other slicer that follows the 3MF Core Specification.\n *\n * @param file  A `File` object (e.g. from an `<input type=\"file\">`)\n * @returns     A {@link ParsedThreeMF} containing everything needed to render\n *              the model.\n *\n * @example\n * ```ts\n * import { parse3MF } from 'parse3mf/core'\n *\n * const result = await parse3MF(myFile)\n * console.log(result.isMultiColor) // true\n * console.log(result.materialSlots) // [{ id: '#FF0000', name: 'Color 1', ... }, ...]\n * ```\n */\nexport async function parse3MF(file: File): Promise<ParsedThreeMF> {\n  try {\n    const arrayBuffer = await file.arrayBuffer()\n    const zip = new JSZip()\n    const zipContent = await zip.loadAsync(arrayBuffer)\n    const zipFiles = Object.keys(zipContent.files)\n\n    // -----------------------------------------------------------------------\n    // Step 1: Find main model file\n    // -----------------------------------------------------------------------\n    let mainModelPath = '3D/3dmodel.model'\n    let mainModelFile = zipContent.file(mainModelPath)\n    if (!mainModelFile) {\n      mainModelPath = '3D/3dModel.model'\n      mainModelFile = zipContent.file(mainModelPath)\n    }\n    if (!mainModelFile) {\n      const modelFiles = zipFiles.filter((f) => f.endsWith('.model') && f.startsWith('3D/'))\n      if (modelFiles.length > 0) {\n        mainModelPath = modelFiles[0]\n        mainModelFile = zipContent.file(mainModelPath)\n      }\n    }\n    if (!mainModelFile) throw new ThreeMFParseError('Invalid .3MF file: no model file found')\n\n    const mainXML = await mainModelFile.async('text')\n    const domParser = new DOMParser()\n    const mainDoc = domParser.parseFromString(mainXML, 'text/xml')\n\n    // -----------------------------------------------------------------------\n    // Step 2: Parse resources\n    // -----------------------------------------------------------------------\n    const mainResources = parseResources(mainDoc)\n\n    // -----------------------------------------------------------------------\n    // Step 3: Build section + composites\n    // -----------------------------------------------------------------------\n    const buildItems: BuildItem[] = []\n    const buildElems = findElements(mainDoc, 'build')\n    if (buildElems.length > 0) {\n      for (const item of findElements(buildElems[0], 'item')) {\n        const objectId = parseInt(item.getAttribute('objectid') || '0')\n        if (objectId > 0) {\n          buildItems.push({ objectId, transform: item.getAttribute('transform') || undefined })\n        }\n      }\n    }\n\n    const compositeToGeometryMap = new Map<number, number[]>()\n    const componentColorOverrides = new Map<number, string>()\n\n    for (const objElem of findElements(mainDoc, 'object')) {\n      const objId = parseInt(objElem.getAttribute('id') || '0')\n      if (objId <= 0) continue\n\n      const components = parseComponents(objElem)\n      if (components.length === 0) continue\n\n      const geomIds: number[] = []\n      for (const comp of components) {\n        geomIds.push(comp.objectId)\n        if (comp.pid) {\n          const overrideColor = resolveColor(comp.pid, comp.pindex || 0, mainResources)\n          if (overrideColor) componentColorOverrides.set(comp.objectId, overrideColor)\n        }\n      }\n      compositeToGeometryMap.set(objId, geomIds)\n    }\n\n    // -----------------------------------------------------------------------\n    // Step 4: Parse ALL geometry objects\n    // -----------------------------------------------------------------------\n    let allGeomObjects: ParsedGeomObject[] = []\n\n    const mainGeomObjects = parseGeometryObjects(mainDoc, mainResources)\n    allGeomObjects.push(...mainGeomObjects)\n\n    const externalObjectFiles = zipFiles\n      .filter((f) => f.startsWith('3D/Objects/') && f.endsWith('.model'))\n      .sort()\n\n    const externalIdRemap = new Map<number, number>()\n\n    if (externalObjectFiles.length > 0) {\n      const mainGeomIds = new Set(mainGeomObjects.map((o) => o.id))\n\n      for (const filePath of externalObjectFiles) {\n        const fileIdMatch = filePath.match(/object_(\\d+)\\.model/)\n        const fileId = fileIdMatch ? parseInt(fileIdMatch[1]) : 0\n        if (mainGeomIds.has(fileId)) continue\n\n        const extFile = zipContent.file(filePath)\n        if (!extFile) continue\n\n        const xml = await extFile.async('text')\n        const doc = domParser.parseFromString(xml, 'text/xml')\n\n        const fileResources = parseResources(doc)\n        let componentOverride = componentColorOverrides.get(fileId) || null\n        if (!componentOverride) {\n          for (const [compObjId, color] of componentColorOverrides) {\n            if (compositeToGeometryMap.has(compObjId)) continue\n            componentOverride = color\n            break\n          }\n        }\n\n        const mergedResources = new Map(mainResources)\n        fileResources.forEach((res, id) => mergedResources.set(id, res))\n\n        const fileObjects = parseGeometryObjects(doc, mergedResources, componentOverride)\n\n        for (const obj of fileObjects) {\n          const mappedId = fileObjects.length === 1 && fileId > 0 ? fileId : obj.id\n          allGeomObjects.push({ ...obj, id: mappedId, sourceFile: filePath })\n          if (mappedId !== obj.id) externalIdRemap.set(obj.id, mappedId)\n        }\n      }\n    }\n\n    // Fix composite map with remapped IDs\n    if (externalIdRemap.size > 0) {\n      compositeToGeometryMap.forEach((geomIds, compositeId) => {\n        compositeToGeometryMap.set(\n          compositeId,\n          geomIds.map((id) => externalIdRemap.get(id) ?? id),\n        )\n      })\n    }\n\n    if (allGeomObjects.length === 0) {\n      throw new ThreeMFParseError('No geometry objects found in 3MF file')\n    }\n\n    // -----------------------------------------------------------------------\n    // Step 5: Slicer-specific coloring\n    // -----------------------------------------------------------------------\n\n    // 5a: Bambu Studio extruder assignments\n    const modelSettings = await parseModelSettings(zipContent)\n\n    // Scan model files for painting keywords\n    const allModelFiles = zipFiles.filter((f) => f.endsWith('.model'))\n    for (const modelPath of allModelFiles) {\n      try {\n        const modelFile = zipContent.file(modelPath)\n        if (!modelFile) continue\n        const xml = await modelFile.async('text')\n        const paintingKeywords = ['mmu_segmentation', 'paint_color', 'mmu_painting', 'FacePainting', 'face_property']\n        for (const keyword of paintingKeywords) {\n          if (xml.includes(keyword)) modelSettings.hasMmuSegmentation = true\n        }\n      } catch {\n        /* ignore */\n      }\n    }\n\n    const filamentData = await extractFilamentColors(zipContent)\n    const filamentColors = filamentData.colors\n    const filamentCount = filamentData.filamentCount\n    const hasMultipleExtruders = modelSettings.distinctExtruders.size > 1\n    const hasMultipleFilaments = filamentCount > 1\n\n    // Apply extruder-based coloring\n    if (modelSettings.objectExtruderMap.size > 0 && filamentColors.length > 0) {\n      allGeomObjects.forEach((obj) => {\n        let extruder = modelSettings.objectExtruderMap.get(obj.id)\n        if (extruder === undefined) {\n          compositeToGeometryMap.forEach((geomIds, compositeId) => {\n            if (geomIds.includes(obj.id)) {\n              const cExt = modelSettings.objectExtruderMap.get(compositeId)\n              if (cExt !== undefined) extruder = cExt\n            }\n          })\n        }\n        if (extruder === undefined && obj.sourceFile) {\n          const fMatch = obj.sourceFile.match(/object_(\\d+)\\.model/)\n          const fId = fMatch ? parseInt(fMatch[1]) : 0\n          if (fId > 0 && fId !== obj.id) extruder = modelSettings.objectExtruderMap.get(fId)\n        }\n        if (extruder !== undefined && extruder > 0 && extruder <= filamentColors.length) {\n          const color = filamentColors[extruder - 1]\n          if (!obj.triangles.some((t) => t.colorHex !== null)) {\n            obj.triangles.forEach((t) => { t.colorHex = color })\n          }\n        }\n      })\n    }\n\n    // 5b: PrusaSlicer volume mapping\n    const prusaData = await parsePrusaSlicerMetadata(zipContent)\n    if (prusaData.volumeRanges.length > 0 && prusaData.extruderColors.length > 0) {\n      let globalTriOffset = 0\n      allGeomObjects.forEach((obj) => {\n        if (obj.triangles.some((t) => t.colorHex !== null)) {\n          globalTriOffset += obj.triangles.length\n          return\n        }\n        for (let i = 0; i < obj.triangles.length; i++) {\n          const globalIdx = globalTriOffset + i\n          for (const range of prusaData.volumeRanges) {\n            if (globalIdx >= range.firstid && globalIdx <= range.lastid) {\n              const color = prusaData.extruderColors[range.extruder - 1]\n              if (color) obj.triangles[i].colorHex = color\n              break\n            }\n          }\n        }\n        globalTriOffset += obj.triangles.length\n      })\n    }\n\n    // 5c: Paint data attributes\n    if (filamentColors.length >= 1) {\n      for (const obj of allGeomObjects) {\n        if (!obj.triangles.some((t) => t.paintAttr)) continue\n\n        let defaultColor = filamentColors[0]\n        let objExtruder = modelSettings.objectExtruderMap.get(obj.id)\n        if (objExtruder === undefined) {\n          compositeToGeometryMap.forEach((geomIds, compositeId) => {\n            if (geomIds.includes(obj.id)) {\n              const cExt = modelSettings.objectExtruderMap.get(compositeId)\n              if (cExt !== undefined) objExtruder = cExt\n            }\n          })\n        }\n        if (objExtruder !== undefined && objExtruder > 0 && objExtruder <= filamentColors.length) {\n          defaultColor = filamentColors[objExtruder - 1]\n        }\n\n        for (const tri of obj.triangles) {\n          if (tri.paintAttr) {\n            const state = decodePaintColorAttr(tri.paintAttr)\n            if (state > 0 && state <= filamentColors.length) {\n              tri.colorHex = filamentColors[state - 1]\n            } else if (state > 0) {\n              tri.colorHex = filamentColors[filamentColors.length - 1]\n            } else {\n              tri.colorHex = defaultColor\n            }\n          } else if (tri.colorHex === null) {\n            tri.colorHex = defaultColor\n          }\n        }\n      }\n    }\n\n    // 5d: Fallback sequential coloring\n    const totalColoredTriangles = allGeomObjects.reduce(\n      (sum, obj) => sum + obj.triangles.filter((t) => t.colorHex !== null).length,\n      0,\n    )\n    if (totalColoredTriangles === 0 && filamentColors.length > 1 && allGeomObjects.length > 1) {\n      if (modelSettings.hasMmuSegmentation || hasMultipleExtruders) {\n        allGeomObjects.forEach((obj, idx) => {\n          const color = filamentColors[idx % filamentColors.length]\n          obj.triangles.forEach((t) => { t.colorHex = color })\n        })\n      }\n    }\n\n    // -----------------------------------------------------------------------\n    // Step 6: Create BufferGeometries\n    // -----------------------------------------------------------------------\n    const geometries: BufferGeometry[] = []\n    const objectIdToGeometryIndex = new Map<number, number>()\n    const triangleMaterialMaps = new Map<number, Map<number, string>>()\n    const allUniqueColors = new Set<string>()\n    let totalVolume = 0\n    let globalBoundingBox = { x: 0, y: 0, z: 0 }\n\n    for (let i = 0; i < allGeomObjects.length; i++) {\n      const obj = allGeomObjects[i]\n      const geometry = new BufferGeometry()\n      geometry.setAttribute('position', new BufferAttribute(new Float32Array(obj.vertices), 3))\n\n      const indices = new Uint32Array(obj.triangles.length * 3)\n      const triColorMap = new Map<number, string>()\n      let hasAnyColor = false\n\n      for (let t = 0; t < obj.triangles.length; t++) {\n        const tri = obj.triangles[t]\n        indices[t * 3] = tri.v1\n        indices[t * 3 + 1] = tri.v2\n        indices[t * 3 + 2] = tri.v3\n        if (tri.colorHex) {\n          triColorMap.set(t, tri.colorHex)\n          allUniqueColors.add(tri.colorHex)\n          hasAnyColor = true\n        }\n      }\n\n      geometry.setIndex(new BufferAttribute(indices, 1))\n      geometry.computeVertexNormals()\n      geometries.push(geometry)\n      objectIdToGeometryIndex.set(obj.id, i)\n      if (hasAnyColor) triangleMaterialMaps.set(i, triColorMap)\n\n      try {\n        totalVolume += calculateVolume(geometry)\n        const bbox = calculateBoundingBox(geometry)\n        globalBoundingBox.x = Math.max(globalBoundingBox.x, bbox.x)\n        globalBoundingBox.y = Math.max(globalBoundingBox.y, bbox.y)\n        globalBoundingBox.z = Math.max(globalBoundingBox.z, bbox.z)\n      } catch {\n        /* skip */\n      }\n    }\n\n    // Map composite IDs\n    compositeToGeometryMap.forEach((geomIds, compositeId) => {\n      if (!objectIdToGeometryIndex.has(compositeId)) {\n        const firstIdx = objectIdToGeometryIndex.get(geomIds[0])\n        if (firstIdx !== undefined) objectIdToGeometryIndex.set(compositeId, firstIdx)\n      }\n    })\n\n    // -----------------------------------------------------------------------\n    // Step 7: Material slots\n    // -----------------------------------------------------------------------\n    const colorArray = Array.from(allUniqueColors).sort()\n    const materialSlots: MaterialSlot[] = []\n\n    const isMultiColorFromColors = colorArray.length > 1\n    const isMultiColorFromExtruders = hasMultipleExtruders && filamentColors.length > 1\n    const isMultiColorFromPainting = modelSettings.hasMmuSegmentation\n    const isMultiColorFromPrusa =\n      prusaData.volumeRanges.length > 0 && new Set(prusaData.volumeRanges.map((r) => r.extruder)).size > 1\n    const isMultiColorFromFilamentConfig = hasMultipleFilaments || filamentColors.length > 1\n    const isMultiColor =\n      isMultiColorFromColors ||\n      isMultiColorFromExtruders ||\n      isMultiColorFromPainting ||\n      isMultiColorFromPrusa ||\n      isMultiColorFromFilamentConfig\n\n    if (colorArray.length > 1) {\n      colorArray.forEach((colorHex, idx) => {\n        const objectIds: number[] = []\n        triangleMaterialMaps.forEach((triMap, geomIdx) => {\n          for (const c of triMap.values()) {\n            if (c === colorHex) {\n              objectIds.push(geomIdx)\n              break\n            }\n          }\n        })\n        if (objectIds.length === 0) objectIds.push(...geometries.map((_, i) => i))\n        materialSlots.push({ id: colorHex, name: `Color ${idx + 1}`, objectIds, selectedColor: colorHex })\n      })\n    } else if (filamentColors.length > 1) {\n      filamentColors.forEach((color, idx) => {\n        const objectIds: number[] = []\n        allGeomObjects.forEach((obj, geomIdx) => {\n          if (obj.triangles.length > 0 && obj.triangles[0].colorHex === color) objectIds.push(geomIdx)\n        })\n        if (objectIds.length === 0) objectIds.push(...geometries.map((_, i) => i))\n        materialSlots.push({ id: color, name: `Filament ${idx + 1}`, objectIds, selectedColor: color })\n      })\n    } else if (filamentCount > 1 && filamentColors.length === 0) {\n      const defaultSlotColors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF', '#FF8000', '#8000FF']\n      for (let i = 0; i < filamentCount; i++) {\n        const slotColor =\n          i < defaultSlotColors.length\n            ? defaultSlotColors[i]\n            : `#${((i * 37) % 256).toString(16).padStart(2, '0')}80FF`\n        materialSlots.push({\n          id: `filament_${i + 1}`,\n          name: `Filament ${i + 1}`,\n          objectIds: geometries.map((_, gi) => gi),\n          selectedColor: slotColor,\n        })\n      }\n    } else if (isMultiColor && prusaData.extruderColors.length > 1) {\n      prusaData.extruderColors.forEach((color, idx) => {\n        materialSlots.push({\n          id: color,\n          name: `Extruder ${idx + 1}`,\n          objectIds: geometries.map((_, i) => i),\n          selectedColor: color,\n        })\n      })\n    } else {\n      materialSlots.push({\n        id: 'default',\n        name: 'Material 1',\n        objectIds: geometries.map((_, i) => i),\n        selectedColor: '#FFFFFF',\n      })\n    }\n\n    // -----------------------------------------------------------------------\n    // Step 8: Plates\n    // -----------------------------------------------------------------------\n    let { plates, plateObjectMap } = await parseBambuPlates(zipContent)\n\n    if (plates.length > 0) {\n      const hasEmpty = plates.some((p) => p.objectIds.length === 0)\n      if (hasEmpty) {\n        const allIds = buildItems.length > 0 ? buildItems.map((b) => b.objectId) : allGeomObjects.map((o) => o.id)\n        plates.forEach((p) => {\n          if (p.objectIds.length === 0) {\n            p.objectIds = [...allIds]\n            plateObjectMap.set(p.id, [...allIds])\n          }\n        })\n      }\n    }\n\n    if (plates.length === 0) {\n      const allObjectIds = allGeomObjects.map((o) => o.id)\n      plates = [{ id: 1, name: 'Plate 1', objectIds: allObjectIds }]\n      plateObjectMap = new Map([[1, allObjectIds]])\n    }\n\n    return {\n      volume: totalVolume,\n      boundingBox: globalBoundingBox,\n      materialSlots,\n      isMultiColor,\n      metadata: {},\n      geometries,\n      triangleMaterialMaps: triangleMaterialMaps.size > 0 ? triangleMaterialMaps : undefined,\n      plates: plates.length > 0 ? plates : undefined,\n      plateObjectMap: plateObjectMap.size > 0 ? plateObjectMap : undefined,\n      objectIdToGeometryIndex: objectIdToGeometryIndex.size > 0 ? objectIdToGeometryIndex : undefined,\n      compositeToGeometryMap: compositeToGeometryMap.size > 0 ? compositeToGeometryMap : undefined,\n    }\n  } catch (error) {\n    if (error instanceof ThreeMFParseError) throw error\n    throw new ThreeMFParseError(\n      `Failed to parse .3MF file: ${error instanceof Error ? error.message : 'Unknown error'}`,\n    )\n  }\n}\n","/**\n * 3MF Exporter  re-packages a .3MF file with **only** color values changed.\n *\n *  DESIGN PRINCIPLE: surgical, field-specific string replacements only.\n *   No DOM parsing / re-serialization. No JSON parse / stringify.\n *   Only the exact color hex values inside known color fields are touched.\n *   Every other byte of the original file is preserved exactly as-is.\n *   Safe for production 3D printing workflows.\n *\n * @packageDocumentation\n */\n\nimport JSZip from 'jszip'\nimport type { MaterialSlot, ColorOption } from './types'\n\n// ---------------------------------------------------------------------------\n// Color helpers\n// ---------------------------------------------------------------------------\n\nconst DEFAULT_COLOR_MAP: Record<string, string> = {\n  White: '#F1F5F9',\n  Black: '#1E293B',\n  Red: '#EF4444',\n  Blue: '#3B82F6',\n  Green: '#22C55E',\n  Yellow: '#EAB308',\n  Orange: '#F97316',\n  Grey: '#64748B',\n  Clear: '#E0F2FE',\n}\n\n/**\n * Resolve a user color selection to an uppercase hex string (#RRGGBB).\n * Accepts hex strings or named colors.\n */\nfunction resolveToHex(color: string, colorOptions?: ColorOption[]): string {\n  if (color.startsWith('#')) {\n    let c = color.toUpperCase()\n    if (c.length === 4) c = `#${c[1]}${c[1]}${c[2]}${c[2]}${c[3]}${c[3]}`\n    if (c.length === 9) c = c.substring(0, 7)\n    return c\n  }\n  if (colorOptions) {\n    const opt = colorOptions.find((o) => o.name === color)\n    if (opt) return opt.hex.toUpperCase()\n  }\n  const hex = DEFAULT_COLOR_MAP[color]\n  return hex ? hex.toUpperCase() : '#808080'\n}\n\n/** Normalize a color string to uppercase #RRGGBB (stripping alpha). */\nfunction normalizeColor(color: string): string {\n  if (!color || color.trim() === '') return '#808080'\n  let c = color.trim()\n  if (!c.startsWith('#')) c = '#' + c\n  if (c.length === 9) c = c.substring(0, 7)\n  return c.toUpperCase()\n}\n\n/**\n * Build a case-insensitive regex that matches a specific 6-digit hex color\n * (with optional 2-digit alpha suffix), ensuring no trailing hex chars.\n */\nfunction hexPattern(hex6: string): RegExp {\n  // hex6 is like \"#AABBCC\"  build pattern that matches case-insensitively\n  // and captures optional alpha suffix\n  const body = hex6.slice(1) // \"AABBCC\"\n  return new RegExp(\n    '#' + body + '([0-9a-fA-F]{2})?(?![0-9a-fA-F])',\n    'gi',\n  )\n}\n\n/** Replace a hex color in a string, preserving any alpha suffix. */\nfunction replaceHex(text: string, oldHex: string, newHex: string): string {\n  return text.replace(hexPattern(oldHex), (_match, alpha) => {\n    return newHex + (alpha || '')\n  })\n}\n\n// ---------------------------------------------------------------------------\n// Cross-referencing helpers: extract color values from different sources\n// so we can map between them when they don't exactly match.\n// ---------------------------------------------------------------------------\n\n/**\n * Extract the ordered list of filament colors from the project_settings\n * config file (JSON or INI format). Returns normalized hex values in\n * filament order. Returns [] if not found.\n */\nasync function extractConfigFilamentColors(zipContent: JSZip): Promise<string[]> {\n  for (const path of ['Metadata/project_settings.config', 'Metadata/Project_settings.config']) {\n    const file = zipContent.file(path)\n    if (!file) continue\n\n    try {\n      const content = await file.async('text')\n      const trimmed = content.trim()\n\n      if (trimmed.startsWith('{')) {\n        // JSON format\n        try {\n          const json = JSON.parse(trimmed)\n          const colorKey = Object.keys(json).find(\n            (k) => k.toLowerCase() === 'filament_colour' || k.toLowerCase() === 'filament_color',\n          )\n          if (colorKey) {\n            const val = json[colorKey]\n            if (Array.isArray(val)) {\n              return val.map((c: string) => normalizeColor(String(c)))\n            }\n            if (typeof val === 'string') {\n              return val\n                .split(';')\n                .map((c: string) => c.trim())\n                .filter((c: string) => c.length > 0)\n                .map((c) => normalizeColor(c))\n            }\n          }\n        } catch {\n          /* try INI fallback */\n        }\n      }\n\n      // INI format\n      const match = content.match(/filament_colou?r\\s*=\\s*(.+)/i)\n      if (match) {\n        return match[1]\n          .split(';')\n          .map((c) => c.trim())\n          .filter((c) => c.length > 0)\n          .map((c) => normalizeColor(c))\n      }\n    } catch {\n      continue\n    }\n  }\n\n  return []\n}\n\n/**\n * Extract ordered displaycolor values from `<base>` elements inside\n * `<basematerials>` blocks in model XML. Also extracts color values\n * from `<color>` elements inside `<colorgroup>` blocks.\n * Returns raw (unnormalized) strings as they appear in the file.\n */\nfunction extractXmlColorValues(xml: string): string[] {\n  const colors: string[] = []\n\n  // From <base ... displaycolor=\"VALUE\" ...>\n  const basePattern = /<base\\b[^>]*?displaycolor\\s*=\\s*[\"']([^\"']*?)[\"'][^>]*?>/gi\n  let match\n  while ((match = basePattern.exec(xml)) !== null) {\n    if (match[1]) colors.push(match[1])\n  }\n\n  // If we found basematerials colors, return them.\n  // Otherwise fall back to colorgroup colors.\n  if (colors.length > 0) return colors\n\n  const colorPattern = /<color\\b[^>]*?\\bcolor\\s*=\\s*[\"']([^\"']*?)[\"'][^>]*?>/gi\n  while ((match = colorPattern.exec(xml)) !== null) {\n    if (match[1]) colors.push(match[1])\n  }\n\n  return colors\n}\n\n/**\n * Build an expanded color remap for the model XML by cross-referencing\n * the config filament colors and the XML basematerials/colorgroup colors.\n *\n * If basematerials has #000000FF for filament 1 but the config has #FF0000FF,\n * and the primary remap (from slot IDs) maps #FF0000  #3B82F6, then we also\n * need to map #000000  #3B82F6 in the model XML. This function adds those\n * extra entries.\n */\nfunction buildModelRemap(\n  xml: string,\n  primaryRemap: Map<string, string>,\n  configColors: string[],\n  materialSlots: MaterialSlot[],\n  colorOptions?: ColorOption[],\n): Map<string, string> {\n  if (primaryRemap.size === 0) return primaryRemap\n\n  const expanded = new Map(primaryRemap)\n  const xmlColors = extractXmlColorValues(xml)\n\n  if (xmlColors.length === 0 || configColors.length === 0) return expanded\n\n  // For each filament position, cross-reference the XML color with the config color.\n  // If only one of them is in the remap, add the other with the same replacement.\n  const len = Math.min(xmlColors.length, configColors.length)\n  for (let i = 0; i < len; i++) {\n    const xmlNorm = normalizeColor(xmlColors[i])\n    const cfgNorm = configColors[i] // already normalized\n\n    // Find the slot that corresponds to this filament position.\n    // A slot matches if its ID equals either the config color or the XML color.\n    const slot = materialSlots.find((s) => {\n      if (!s.id.startsWith('#')) return false\n      const slotNorm = normalizeColor(s.id)\n      return slotNorm === cfgNorm || slotNorm === xmlNorm\n    })\n\n    if (!slot) continue\n\n    const newHex = resolveToHex(slot.selectedColor, colorOptions)\n    const slotNorm = normalizeColor(slot.id)\n\n    // Only add if this slot's color was actually changed\n    if (slotNorm === newHex) continue\n\n    // Add the XML basematerials color to the remap if it's not already there\n    if (!expanded.has(xmlNorm)) {\n      expanded.set(xmlNorm, newHex)\n    }\n    // Also ensure the config color is in the remap (covers the reverse mismatch)\n    if (!expanded.has(cfgNorm)) {\n      expanded.set(cfgNorm, newHex)\n    }\n  }\n\n  return expanded\n}\n\n// ---------------------------------------------------------------------------\n// Options\n// ---------------------------------------------------------------------------\n\nexport interface Export3MFOptions {\n  /**\n   * The original .3MF file. Used as the base  only color values are changed.\n   */\n  originalFile: File | Blob | ArrayBuffer\n  /**\n   * The current material slots with the user's color selections.\n   */\n  materialSlots: MaterialSlot[]\n  /**\n   * Optional color options to resolve named colors to hex.\n   * Defaults to the built-in color map.\n   */\n  colorOptions?: ColorOption[]\n  /**\n   * Output filename (without extension). Default: original filename + \"_modified\".\n   */\n  filename?: string\n}\n\n// ---------------------------------------------------------------------------\n// Core export function\n// ---------------------------------------------------------------------------\n\n/**\n * Export a modified `.3MF` file with **only** updated color values.\n *\n * Every byte of the original file is preserved except for the exact color\n * hex strings inside known color fields. No XML re-serialization, no JSON\n * reformatting. Safe for production 3D printing workflows.\n *\n * @example\n * ```ts\n * import { export3MF } from 'parse3mf/core'\n *\n * const blob = await export3MF({\n *   originalFile: myFile,\n *   materialSlots: updatedSlots,\n * })\n * ```\n */\nexport async function export3MF(options: Export3MFOptions): Promise<Blob> {\n  const { originalFile, materialSlots, colorOptions } = options\n\n  const arrayBuffer =\n    originalFile instanceof ArrayBuffer\n      ? originalFile\n      : await (originalFile as Blob).arrayBuffer()\n\n  const zip = new JSZip()\n  const zipContent = await zip.loadAsync(arrayBuffer)\n\n  // Build color remap: original (slot.id)  new hex.\n  // Only entries where the color actually changed.\n  const colorRemap = new Map<string, string>()\n  for (const slot of materialSlots) {\n    // Skip non-hex slot IDs (e.g. \"filament_1\")  these can't be\n    // matched in the raw file text.\n    if (!slot.id.startsWith('#')) continue\n\n    const originalNorm = normalizeColor(slot.id)\n    const newHex = resolveToHex(slot.selectedColor, colorOptions)\n    if (originalNorm !== newHex) {\n      colorRemap.set(originalNorm, newHex)\n    }\n  }\n\n  if (colorRemap.size === 0) {\n    // Nothing changed  return the original file byte-for-byte.\n    return new Blob([arrayBuffer], {\n      type: 'application/vnd.ms-package.3dmanufacturing-3dmodel+xml',\n    })\n  }\n\n  // -----------------------------------------------------------------------\n  // Extract config filament colors for cross-referencing.\n  // The parser may derive slot IDs from config colors, but the model XML\n  // basematerials might have different hex values for the same filaments.\n  // We need to cover both representations in the remap.\n  // -----------------------------------------------------------------------\n  const configColors = await extractConfigFilamentColors(zipContent)\n\n  // Build a comprehensive remap that covers BOTH config-derived AND\n  // XML-derived color values (for when they differ).\n  let comprehensiveRemap = colorRemap\n\n  // -----------------------------------------------------------------------\n  // 1. Patch .model XML files\n  //    Only touches displaycolor=\"...\" on <base> elements\n  //    and color=\"...\" on <color> elements.\n  // -----------------------------------------------------------------------\n  const modelFiles = Object.keys(zipContent.files).filter(\n    (f) => f.endsWith('.model') && f.startsWith('3D/'),\n  )\n\n  for (const modelPath of modelFiles) {\n    const modelFile = zipContent.file(modelPath)\n    if (!modelFile) continue\n\n    const xml = await modelFile.async('text')\n\n    // Build an expanded remap for this model file that includes\n    // basematerials colors even if they differ from the slot IDs.\n    const modelRemap = buildModelRemap(xml, colorRemap, configColors, materialSlots, colorOptions)\n\n    // Merge any new entries back into the comprehensive remap so that\n    // config and slice_info files also benefit from the cross-reference.\n    if (modelRemap.size > colorRemap.size) {\n      comprehensiveRemap = new Map([...comprehensiveRemap, ...modelRemap])\n    }\n\n    const patched = patchModelXmlColors(xml, modelRemap)\n    if (patched !== xml) {\n      zipContent.file(modelPath, patched)\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // 2. Patch Bambu Studio project_settings.config\n  //    ONLY touches filament_colour / filament_color field values.\n  // -----------------------------------------------------------------------\n  for (const configPath of [\n    'Metadata/project_settings.config',\n    'Metadata/Project_settings.config',\n  ]) {\n    const configFile = zipContent.file(configPath)\n    if (!configFile) continue\n\n    try {\n      const content = await configFile.async('text')\n      const patched = patchProjectSettingsColors(content, comprehensiveRemap)\n      if (patched !== content) {\n        zipContent.file(configPath, patched)\n      }\n    } catch {\n      /* leave file untouched */\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // 3. Patch slice_info.config\n  //    ONLY touches color=\"...\" attributes on <filament> elements.\n  // -----------------------------------------------------------------------\n  const sliceInfoFile = zipContent.file('Metadata/slice_info.config')\n  if (sliceInfoFile) {\n    try {\n      const content = await sliceInfoFile.async('text')\n      const patched = patchSliceInfoColors(content, comprehensiveRemap)\n      if (patched !== content) {\n        zipContent.file('Metadata/slice_info.config', patched)\n      }\n    } catch {\n      /* leave file untouched */\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // 4. Patch PrusaSlicer config files\n  //    ONLY touches extruder_colour / filament_colour lines.\n  // -----------------------------------------------------------------------\n  const slicerConfigs = Object.keys(zipContent.files).filter(\n    (f) => f.includes('Slic3r') && f.endsWith('.config'),\n  )\n  for (const configPath of slicerConfigs) {\n    const configFile = zipContent.file(configPath)\n    if (!configFile) continue\n\n    try {\n      const content = await configFile.async('text')\n      const patched = patchPrusaSlicerColors(content, comprehensiveRemap)\n      if (patched !== content) {\n        zipContent.file(configPath, patched)\n      }\n    } catch {\n      /* leave file untouched */\n    }\n  }\n\n  // -----------------------------------------------------------------------\n  // 5. Re-package ZIP  let JSZip preserve original compression per file.\n  // -----------------------------------------------------------------------\n  const blob = await zipContent.generateAsync({\n    type: 'blob',\n    mimeType: 'application/vnd.ms-package.3dmanufacturing-3dmodel+xml',\n  })\n\n  return blob\n}\n\n// ---------------------------------------------------------------------------\n// 1. Model XML: displaycolor on <base>, color on <color> elements\n//\n//    We match the ENTIRE <base .../> or <color .../> element tag and only\n//    replace the color attribute value within it. This avoids accidentally\n//    matching a \"color\" attribute on unrelated elements.\n// ---------------------------------------------------------------------------\n\nfunction patchModelXmlColors(xml: string, remap: Map<string, string>): string {\n  if (remap.size === 0) return xml\n\n  let result = xml\n\n  // <base ... displaycolor=\"VALUE\" ...>  basematerials color definitions\n  result = patchAttrInTag(result, 'base', 'displaycolor', remap)\n\n  // <color ... color=\"VALUE\" ...>  colorgroup color definitions\n  result = patchAttrInTag(result, 'color', 'color', remap)\n\n  return result\n}\n\n/**\n * Inside all occurrences of <tagName ...>, find the attribute `attrName=\"VALUE\"`\n * and replace VALUE using the color remap. Everything else is untouched.\n */\nfunction patchAttrInTag(\n  xml: string,\n  tagName: string,\n  attrName: string,\n  remap: Map<string, string>,\n): string {\n  // Match: <tagName ... attrName=\"value\" ...> (self-closing or not)\n  // We use a two-pass approach:\n  //   1. Find each <tagName ...> tag\n  //   2. Within that tag, find and replace the specific attribute value\n  const tagPattern = new RegExp(\n    `(<${tagName}\\\\b)([^>]*>)`,\n    'gi',\n  )\n\n  return xml.replace(tagPattern, (fullTag, tagOpen, rest) => {\n    // Within this tag, find attrName=\"value\" and replace the value\n    const attrPattern = new RegExp(\n      `(\\\\b${attrName}\\\\s*=\\\\s*([\"']))([^\"']*?)(\\\\2)`,\n      'gi',\n    )\n\n    const newRest = rest.replace(attrPattern, (\n      attrMatch: string,\n      prefix: string,\n      _quote: string,\n      colorVal: string,\n      closingQuote: string,\n    ) => {\n      const normalized = normalizeColor(colorVal)\n      const replacement = remap.get(normalized)\n      if (!replacement) return attrMatch\n\n      const newVal = preserveAlpha(colorVal, replacement)\n      return prefix + newVal + closingQuote\n    })\n\n    return tagOpen + newRest\n  })\n}\n\n/** Given original color value \"colorVal\" and new hex, preserve alpha suffix. */\nfunction preserveAlpha(originalVal: string, newHex: string): string {\n  const trimmed = originalVal.trim()\n  // Check if original had alpha (9 chars with #, or 8 chars without)\n  const withHash = trimmed.startsWith('#') ? trimmed : '#' + trimmed\n  if (withHash.length === 9) {\n    // Preserve the original alpha characters\n    return newHex + withHash.slice(7)\n  }\n  return newHex\n}\n\n// ---------------------------------------------------------------------------\n// 2. project_settings.config: ONLY filament_colour / filament_color fields\n//\n//    In JSON format: \"filament_colour\": [\"#FF0000FF\", \"#00FF00FF\"]\n//    In INI format:  filament_colour = #FF0000FF;#00FF00FF\n//\n//    We locate the specific field and replace colors within it only.\n// ---------------------------------------------------------------------------\n\nfunction patchProjectSettingsColors(\n  content: string,\n  remap: Map<string, string>,\n): string {\n  if (remap.size === 0) return content\n\n  const trimmed = content.trim()\n\n  if (trimmed.startsWith('{')) {\n    // JSON format  find the filament_colour/filament_color key and\n    // replace hex values within its array value only.\n    return patchJsonFilamentColors(content, remap)\n  }\n\n  // INI format  only touch the filament_colour line\n  return patchIniColorLine(content, remap)\n}\n\n/**\n * In a JSON config string, find the \"filament_colour\" (or \"filament_color\")\n * array and replace each color value. Everything else is untouched.\n */\nfunction patchJsonFilamentColors(\n  content: string,\n  remap: Map<string, string>,\n): string {\n  // Match: \"filament_colour\" : [ ... ] or \"filament_color\" : [ ... ]\n  // We capture the key + the array content.\n  const pattern = /(\"filament_colou?r\"\\s*:\\s*\\[)([^\\]]*?)(\\])/gi\n\n  return content.replace(pattern, (fullMatch, prefix, arrayContent, suffix) => {\n    // Within the array content, replace each hex color value\n    let newContent = arrayContent\n    for (const [oldHex, newHex] of remap) {\n      newContent = replaceHex(newContent, oldHex, newHex)\n    }\n    return prefix + newContent + suffix\n  })\n}\n\n/**\n * In an INI-style config, only replace colors on the filament_colour line.\n */\nfunction patchIniColorLine(content: string, remap: Map<string, string>): string {\n  return content.replace(\n    /^(filament_colou?r\\s*=\\s*)(.+)$/gim,\n    (_fullMatch, prefix, colorsLine) => {\n      let newLine = colorsLine\n      for (const [oldHex, newHex] of remap) {\n        newLine = replaceHex(newLine, oldHex, newHex)\n      }\n      return prefix + newLine\n    },\n  )\n}\n\n// ---------------------------------------------------------------------------\n// 3. slice_info.config: ONLY color=\"...\" on <filament> elements\n// ---------------------------------------------------------------------------\n\nfunction patchSliceInfoColors(\n  content: string,\n  remap: Map<string, string>,\n): string {\n  if (remap.size === 0) return content\n\n  // Match <filament ...> tags and replace color attributes within them\n  return patchAttrInTag(content, 'filament', 'color', remap)\n}\n\n// ---------------------------------------------------------------------------\n// 4. PrusaSlicer: ONLY extruder_colour / filament_colour lines\n// ---------------------------------------------------------------------------\n\nfunction patchPrusaSlicerColors(content: string, remap: Map<string, string>): string {\n  if (remap.size === 0) return content\n\n  return content.replace(\n    /^((?:extruder|filament)_colou?r\\s*=\\s*)(.+)$/gim,\n    (_fullMatch, prefix, colorsLine) => {\n      let newLine = colorsLine\n      for (const [oldHex, newHex] of remap) {\n        newLine = replaceHex(newLine, oldHex, newHex)\n      }\n      return prefix + newLine\n    },\n  )\n}\n\n// ---------------------------------------------------------------------------\n// Convenience: trigger download in the browser\n// ---------------------------------------------------------------------------\n\n/**\n * Export a modified `.3MF` and trigger a browser download.\n *\n * @example\n * ```ts\n * import { download3MF } from 'parse3mf/core'\n *\n * await download3MF({\n *   originalFile: myFile,\n *   materialSlots: updatedSlots,\n *   filename: 'my-model-recolored',\n * })\n * ```\n */\nexport async function download3MF(options: Export3MFOptions): Promise<void> {\n  const blob = await export3MF(options)\n\n  const defaultName =\n    options.originalFile instanceof File\n      ? options.originalFile.name.replace(/\\.3mf$/i, '') + '_modified'\n      : 'model_modified'\n\n  const filename = (options.filename || defaultName) + '.3mf'\n\n  const url = URL.createObjectURL(blob)\n  const a = document.createElement('a')\n  a.href = url\n  a.download = filename\n  document.body.appendChild(a)\n  a.click()\n  document.body.removeChild(a)\n  URL.revokeObjectURL(url)\n}\n","import { createContext, useContext, useReducer, useCallback, useRef, useEffect, type ReactNode } from 'react'\nimport type { ParsedThreeMF, MaterialSlot, Plate, ColorOption, ViewerTheme } from '../core/types'\nimport { parse3MF, ThreeMFParseError } from '../core/parser'\nimport { export3MF, download3MF } from '../core/exporter'\nimport type { BufferGeometry } from 'three'\n\n// ---------------------------------------------------------------------------\n// State\n// ---------------------------------------------------------------------------\n\nexport interface ThreeMFState {\n  /** The parsed model data (null before first parse). */\n  model: ParsedThreeMF | null\n  /** The original file (kept for re-export). */\n  originalFile: File | null\n  /** Whether the parser is currently running. */\n  loading: boolean\n  /** Whether an export is currently running. */\n  exporting: boolean\n  /** Last parse error, if any. */\n  error: Error | null\n  /** Currently selected plate ID. */\n  selectedPlateId: number | null\n  /** Current material slot state (with user color selections). */\n  materialSlots: MaterialSlot[]\n  /** The user's single-colour pick (for non-multicolor models). */\n  color: string\n}\n\ntype Action =\n  | { type: 'PARSE_START'; file: File }\n  | { type: 'PARSE_SUCCESS'; payload: ParsedThreeMF }\n  | { type: 'PARSE_ERROR'; payload: Error }\n  | { type: 'SET_SLOT_COLOR'; slotId: string; color: string }\n  | { type: 'SET_PLATE'; plateId: number | null }\n  | { type: 'SET_COLOR'; color: string }\n  | { type: 'EXPORT_START' }\n  | { type: 'EXPORT_DONE' }\n  | { type: 'RESET' }\n\nfunction reducer(state: ThreeMFState, action: Action): ThreeMFState {\n  switch (action.type) {\n    case 'PARSE_START':\n      return { ...state, loading: true, error: null, originalFile: action.file }\n    case 'PARSE_SUCCESS': {\n      const m = action.payload\n      return {\n        ...state,\n        model: m,\n        loading: false,\n        error: null,\n        materialSlots: m.materialSlots,\n        selectedPlateId: m.plates?.[0]?.id ?? null,\n      }\n    }\n    case 'PARSE_ERROR':\n      return { ...state, loading: false, error: action.payload, model: null, materialSlots: [] }\n    case 'SET_SLOT_COLOR':\n      return {\n        ...state,\n        materialSlots: state.materialSlots.map((s) =>\n          s.id === action.slotId ? { ...s, selectedColor: action.color } : s,\n        ),\n      }\n    case 'SET_PLATE':\n      return { ...state, selectedPlateId: action.plateId }\n    case 'SET_COLOR':\n      return { ...state, color: action.color }\n    case 'EXPORT_START':\n      return { ...state, exporting: true }\n    case 'EXPORT_DONE':\n      return { ...state, exporting: false }\n    case 'RESET':\n      return initialState\n    default:\n      return state\n  }\n}\n\nconst initialState: ThreeMFState = {\n  model: null,\n  originalFile: null,\n  loading: false,\n  exporting: false,\n  error: null,\n  selectedPlateId: null,\n  materialSlots: [],\n  color: '#f1f5f9',\n}\n\n// ---------------------------------------------------------------------------\n// Context\n// ---------------------------------------------------------------------------\n\nexport interface ThreeMFContextValue extends ThreeMFState {\n  /** Parse a .3MF file. */\n  loadFile: (file: File) => Promise<ParsedThreeMF | null>\n  /** Change the color of a material slot. */\n  setSlotColor: (slotId: string, color: string) => void\n  /** Select a plate. */\n  selectPlate: (plateId: number | null) => void\n  /** Set the single colour for non-multicolor models. */\n  setColor: (color: string) => void\n  /** Export the modified .3MF as a Blob. */\n  exportFile: (colorOptions?: ColorOption[]) => Promise<Blob | null>\n  /** Export and trigger a browser download of the modified .3MF. */\n  downloadFile: (filename?: string, colorOptions?: ColorOption[]) => Promise<void>\n  /** Whether the model has color changes compared to the original. */\n  hasColorChanges: boolean\n  /** Reset all state. */\n  reset: () => void\n\n  // Derived convenience accessors\n  isMultiColor: boolean\n  plates: Plate[]\n  geometries: BufferGeometry[]\n  triangleMaterialMaps: Map<number, Map<number, string>> | undefined\n  objectIdToGeometryIndex: Map<number, number> | undefined\n  compositeToGeometryMap: Map<number, number[]> | undefined\n  plateObjectMap: Map<number, number[]> | undefined\n}\n\nconst Ctx = createContext<ThreeMFContextValue | null>(null)\n\n// ---------------------------------------------------------------------------\n// Provider\n// ---------------------------------------------------------------------------\n\nexport interface ThreeMFProviderProps {\n  children: ReactNode\n  /** Called after a successful parse. */\n  onParsed?: (result: ParsedThreeMF) => void\n  /** Called on parse error. */\n  onError?: (error: Error) => void\n  /** Called when a slot colour changes. */\n  onSlotColorChange?: (slotId: string, color: string, allSlots: MaterialSlot[]) => void\n  /** Called when the active plate changes. */\n  onPlateChange?: (plateId: number) => void\n  /** Called after a successful export/download. */\n  onExported?: (blob: Blob) => void\n}\n\nexport function ThreeMFProvider({\n  children,\n  onParsed,\n  onError,\n  onSlotColorChange,\n  onPlateChange,\n  onExported,\n}: ThreeMFProviderProps) {\n  const [state, dispatch] = useReducer(reducer, initialState)\n  const callbackRefs = useRef({ onParsed, onError, onSlotColorChange, onPlateChange, onExported })\n  callbackRefs.current = { onParsed, onError, onSlotColorChange, onPlateChange, onExported }\n\n  const loadFile = useCallback(async (file: File): Promise<ParsedThreeMF | null> => {\n    dispatch({ type: 'PARSE_START', file })\n    try {\n      const result = await parse3MF(file)\n      dispatch({ type: 'PARSE_SUCCESS', payload: result })\n      callbackRefs.current.onParsed?.(result)\n      return result\n    } catch (err) {\n      const error = err instanceof Error ? err : new Error(String(err))\n      dispatch({ type: 'PARSE_ERROR', payload: error })\n      callbackRefs.current.onError?.(error)\n      return null\n    }\n  }, [])\n\n  const setSlotColor = useCallback((slotId: string, color: string) => {\n    dispatch({ type: 'SET_SLOT_COLOR', slotId, color })\n  }, [])\n\n  // Fire callback on slot colour change\n  useEffect(() => {\n    if (state.materialSlots.length > 0) {\n      // We don't know *which* slot changed, so just provide them all.\n      // The parent can diff if needed.\n    }\n  }, [state.materialSlots])\n\n  const selectPlate = useCallback((plateId: number | null) => {\n    dispatch({ type: 'SET_PLATE', plateId })\n    if (plateId !== null) callbackRefs.current.onPlateChange?.(plateId)\n  }, [])\n\n  const setColor = useCallback((color: string) => {\n    dispatch({ type: 'SET_COLOR', color })\n  }, [])\n\n  // Use a ref to always access the latest state inside callbacks\n  const stateRef = useRef(state)\n  stateRef.current = state\n\n  const exportFile = useCallback(async (colorOptions?: ColorOption[]): Promise<Blob | null> => {\n    const s = stateRef.current\n    if (!s.originalFile || !s.model) return null\n    dispatch({ type: 'EXPORT_START' })\n    try {\n      const blob = await export3MF({\n        originalFile: s.originalFile,\n        materialSlots: s.materialSlots,\n        colorOptions,\n      })\n      dispatch({ type: 'EXPORT_DONE' })\n      callbackRefs.current.onExported?.(blob)\n      return blob\n    } catch (err) {\n      dispatch({ type: 'EXPORT_DONE' })\n      console.error('[parse3mf] Export failed:', err)\n      return null\n    }\n  }, [])\n\n  const downloadFile = useCallback(async (filename?: string, colorOptions?: ColorOption[]): Promise<void> => {\n    const s = stateRef.current\n    if (!s.originalFile || !s.model) return\n    dispatch({ type: 'EXPORT_START' })\n    try {\n      await download3MF({\n        originalFile: s.originalFile,\n        materialSlots: s.materialSlots,\n        colorOptions,\n        filename,\n      })\n      dispatch({ type: 'EXPORT_DONE' })\n    } catch (err) {\n      dispatch({ type: 'EXPORT_DONE' })\n      console.error('[parse3mf] Download failed:', err)\n    }\n  }, [])\n\n  const reset = useCallback(() => {\n    dispatch({ type: 'RESET' })\n  }, [])\n\n  // Check if colors have been changed from original\n  const hasColorChanges = state.model\n    ? state.materialSlots.some((slot) => {\n        const original = state.model!.materialSlots.find((s) => s.id === slot.id)\n        return original ? original.selectedColor !== slot.selectedColor : false\n      })\n    : false\n\n  const value: ThreeMFContextValue = {\n    ...state,\n    loadFile,\n    setSlotColor,\n    selectPlate,\n    setColor,\n    exportFile,\n    downloadFile,\n    hasColorChanges,\n    reset,\n    isMultiColor: state.model?.isMultiColor ?? false,\n    plates: state.model?.plates ?? [],\n    geometries: (state.model?.geometries ?? []) as BufferGeometry[],\n    triangleMaterialMaps: state.model?.triangleMaterialMaps,\n    objectIdToGeometryIndex: state.model?.objectIdToGeometryIndex,\n    compositeToGeometryMap: state.model?.compositeToGeometryMap,\n    plateObjectMap: state.model?.plateObjectMap,\n  }\n\n  return <Ctx.Provider value={value}>{children}</Ctx.Provider>\n}\n\n// ---------------------------------------------------------------------------\n// Hook\n// ---------------------------------------------------------------------------\n\n/**\n * Access the 3MF viewer state and actions.\n *\n * Must be used inside a `<ThreeMFProvider>`.\n *\n * @example\n * ```tsx\n * function MyComponent() {\n *   const { loadFile, model, materialSlots } = useThreeMF()\n *   return <input type=\"file\" onChange={e => loadFile(e.target.files![0])} />\n * }\n * ```\n */\nexport function useThreeMF(): ThreeMFContextValue {\n  const ctx = useContext(Ctx)\n  if (!ctx) {\n    throw new Error('useThreeMF() must be used inside <ThreeMFProvider>')\n  }\n  return ctx\n}\n","import type { ViewerTheme, ColorOption } from '../core/types'\n\nexport const DEFAULT_THEME: Required<ViewerTheme> = {\n  background: '#0f172a',\n  fontFamily: 'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace',\n  accent: '#3b82f6',\n  surface: '#1e293b',\n  text: '#e2e8f0',\n  textMuted: '#94a3b8',\n  border: 'rgba(59,130,246,0.3)',\n}\n\nexport const DEFAULT_COLOR_OPTIONS: ColorOption[] = [\n  { name: 'White', hex: '#f1f5f9' },\n  { name: 'Black', hex: '#1e293b' },\n  { name: 'Red', hex: '#ef4444' },\n  { name: 'Blue', hex: '#3b82f6' },\n  { name: 'Green', hex: '#22c55e' },\n  { name: 'Yellow', hex: '#eab308' },\n  { name: 'Orange', hex: '#f97316' },\n  { name: 'Grey', hex: '#64748b' },\n]\n\nexport function resolveTheme(overrides?: ViewerTheme): Required<ViewerTheme> {\n  return { ...DEFAULT_THEME, ...overrides }\n}\n\n/** Convert a named color or #hex string  Three.js int. */\nexport function colorToHex(v: string): number {\n  if (v.startsWith('#')) return parseInt(v.slice(1), 16)\n  const opt = DEFAULT_COLOR_OPTIONS.find((o) => o.name === v)\n  return opt ? parseInt(opt.hex.slice(1), 16) : 0x3b82f6\n}\n\n/** CSS-safe hex for a named or hex colour. */\nexport function colorToCss(v: string): string {\n  if (v.startsWith('#')) return v\n  const opt = DEFAULT_COLOR_OPTIONS.find((o) => o.name === v)\n  return opt ? opt.hex : '#94a3b8'\n}\n","import { useEffect, useRef, useMemo, useState } from 'react'\nimport * as THREE from 'three'\nimport { BufferAttribute } from 'three'\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js'\nimport { useThreeMF } from './context'\nimport type { MaterialSlot, ViewerTheme } from '../core/types'\nimport { resolveTheme, colorToHex } from '../styles/theme'\n\n// ---------------------------------------------------------------------------\n// Multi-material group builder\n// ---------------------------------------------------------------------------\n\nfunction buildMultiMaterialGeometry(\n  src: THREE.BufferGeometry,\n  triColorMap: Map<number, string>,\n  slots: MaterialSlot[],\n): { geometry: THREE.BufferGeometry; materials: THREE.MeshPhongMaterial[]; slotOrder: number[] } | null {\n  const idx = src.index\n  const pos = src.attributes.position\n  if (!idx || !pos || slots.length === 0) return null\n\n  const arr = idx.array\n  const triCount = idx.count / 3\n  const c2s = new Map<string, number>()\n  slots.forEach((s, i) => c2s.set(s.id, i))\n\n  const buckets: number[][] = slots.map(() => [])\n  for (let t = 0; t < triCount; t++) {\n    const hex = triColorMap.get(t)\n    if (hex === undefined) {\n      buckets[0].push(t)\n    } else {\n      const si = c2s.get(hex)\n      if (si !== undefined) buckets[si].push(t)\n      else buckets[0].push(t)\n    }\n  }\n\n  const sortedIndices = new Uint32Array(triCount * 3)\n  const groups: { start: number; count: number; materialIndex: number }[] = []\n  const slotOrder: number[] = []\n  let writeOffset = 0\n\n  for (let si = 0; si < slots.length; si++) {\n    const bucket = buckets[si]\n    if (bucket.length === 0) continue\n    const groupStart = writeOffset * 3\n    for (const triIdx of bucket) {\n      const base = triIdx * 3\n      sortedIndices[writeOffset * 3] = arr[base]\n      sortedIndices[writeOffset * 3 + 1] = arr[base + 1]\n      sortedIndices[writeOffset * 3 + 2] = arr[base + 2]\n      writeOffset++\n    }\n    groups.push({ start: groupStart, count: bucket.length * 3, materialIndex: groups.length })\n    slotOrder.push(si)\n  }\n\n  const geom = new THREE.BufferGeometry()\n  geom.setAttribute('position', pos.clone())\n  if (src.attributes.normal) geom.setAttribute('normal', src.attributes.normal.clone())\n  geom.setIndex(new BufferAttribute(sortedIndices, 1))\n  for (const g of groups) geom.addGroup(g.start, g.count, g.materialIndex)\n  geom.computeVertexNormals()\n\n  const materials = slotOrder.map((si) =>\n    new THREE.MeshPhongMaterial({ color: colorToHex(slots[si].selectedColor), specular: 0x111111, shininess: 200 }),\n  )\n\n  return { geometry: geom, materials, slotOrder }\n}\n\n// ---------------------------------------------------------------------------\n// Scene helpers\n// ---------------------------------------------------------------------------\n\nfunction centerAndScale(meshes: THREE.Mesh[], scene: THREE.Scene) {\n  if (meshes.length === 0) return\n  const tmp = new THREE.Group()\n  meshes.forEach((m) => tmp.add(m))\n  const box = new THREE.Box3().setFromObject(tmp)\n  const center = new THREE.Vector3()\n  const size = new THREE.Vector3()\n  box.getCenter(center)\n  box.getSize(size)\n  const maxDim = Math.max(size.x, size.y, size.z)\n  const scale = maxDim > 0 ? 100 / maxDim : 1\n  meshes.forEach((m) => {\n    tmp.remove(m)\n    m.position.sub(center)\n    m.scale.setScalar(scale)\n    scene.add(m)\n  })\n}\n\nfunction makeMaterial(hex: number): THREE.MeshPhongMaterial {\n  return new THREE.MeshPhongMaterial({ color: hex, specular: 0x111111, shininess: 200 })\n}\n\n// ---------------------------------------------------------------------------\n// Component\n// ---------------------------------------------------------------------------\n\nexport interface ViewerProps {\n  /** Theme overrides. */\n  theme?: ViewerTheme\n  /** CSS class for the container div. */\n  className?: string\n  /** Inline styles for the container div. */\n  style?: React.CSSProperties\n  /** Show multicolor debug overlay. Default: false. */\n  showDebugOverlay?: boolean\n}\n\n/**\n * The 3D viewport that renders the parsed model.\n *\n * Must be used inside a `<ThreeMFProvider>`.\n */\nexport function Viewer({ theme: themeOverrides, className, style, showDebugOverlay }: ViewerProps) {\n  const containerRef = useRef<HTMLDivElement>(null)\n  const theme = resolveTheme(themeOverrides)\n\n  // Persistent Three.js objects\n  const sceneRef = useRef<THREE.Scene | null>(null)\n  const cameraRef = useRef<THREE.PerspectiveCamera | null>(null)\n  const rendererRef = useRef<THREE.WebGLRenderer | null>(null)\n  const controlsRef = useRef<OrbitControls | null>(null)\n  const rafRef = useRef(0)\n\n  const meshesRef = useRef<THREE.Mesh[]>([])\n  const slotOrderRef = useRef<Map<number, number[]>>(new Map())\n  const ownedGeomsRef = useRef<Set<THREE.BufferGeometry>>(new Set())\n\n  const [debugInfo, setDebugInfo] = useState('')\n\n  const {\n    model,\n    loading,\n    error,\n    geometries,\n    materialSlots,\n    isMultiColor,\n    triangleMaterialMaps,\n    selectedPlateId,\n    plates,\n    plateObjectMap,\n    objectIdToGeometryIndex,\n    compositeToGeometryMap,\n    color,\n  } = useThreeMF()\n\n  const slotsRef = useRef(materialSlots)\n  slotsRef.current = materialSlots\n\n  // -----------------------------------------------------------------------\n  // Plate filtering\n  // -----------------------------------------------------------------------\n  const { filteredGeometries, originalIndices } = useMemo(() => {\n    const all = geometries ?? []\n    const fallback = {\n      filteredGeometries: all as THREE.BufferGeometry[],\n      originalIndices: all.map((_: unknown, i: number) => i),\n    }\n    if (!geometries || !plates?.length || !selectedPlateId || !plateObjectMap || !objectIdToGeometryIndex)\n      return fallback\n\n    const plate = plates.find((p) => p.id === selectedPlateId)\n    if (!plate) return fallback\n\n    const objIds = plateObjectMap?.get(selectedPlateId) ?? plate.objectIds\n    if (!objIds?.length) return fallback\n\n    const gSet = new Set<number>()\n    for (const oid of objIds) {\n      const direct = objectIdToGeometryIndex?.get(oid)\n      if (direct !== undefined) { gSet.add(direct); continue }\n      if (compositeToGeometryMap) {\n        const children = compositeToGeometryMap.get(oid)\n        if (children) { children.forEach((cid) => { const ci = objectIdToGeometryIndex?.get(cid); if (ci !== undefined) gSet.add(ci) }); continue }\n      }\n    }\n    if (gSet.size === 0) return fallback\n    const sorted = [...gSet].sort((a, b) => a - b)\n    return {\n      filteredGeometries: sorted.map((i) => geometries[i]).filter(Boolean) as THREE.BufferGeometry[],\n      originalIndices: sorted.filter((i) => !!geometries[i]),\n    }\n  }, [geometries, plates, selectedPlateId, plateObjectMap, objectIdToGeometryIndex, compositeToGeometryMap])\n\n  // =======================================================================\n  // EFFECT 1  Three.js bootstrap (mount-only)\n  // =======================================================================\n  useEffect(() => {\n    const el = containerRef.current\n    if (!el) return\n\n    const scene = new THREE.Scene()\n    scene.background = new THREE.Color(theme.background)\n\n    const w = el.clientWidth || 300\n    const h = el.clientHeight || 300\n    const camera = new THREE.PerspectiveCamera(50, w / h, 0.1, 2000)\n    camera.position.z = 150\n\n    const renderer = new THREE.WebGLRenderer({ antialias: true })\n    renderer.setSize(w, h)\n    renderer.setPixelRatio(window.devicePixelRatio)\n    el.appendChild(renderer.domElement)\n\n    const controls = new OrbitControls(camera, renderer.domElement)\n    controls.enableDamping = true\n    controls.dampingFactor = 0.05\n\n    scene.add(new THREE.AmbientLight(0xffffff, 0.5))\n    const d1 = new THREE.DirectionalLight(0xffffff, 0.8)\n    d1.position.set(1, 1, 1)\n    scene.add(d1)\n    const d2 = new THREE.DirectionalLight(0xffffff, 0.5)\n    d2.position.set(-1, -1, -1)\n    scene.add(d2)\n\n    sceneRef.current = scene\n    cameraRef.current = camera\n    rendererRef.current = renderer\n    controlsRef.current = controls\n\n    const loop = () => {\n      rafRef.current = requestAnimationFrame(loop)\n      controls.update()\n      renderer.render(scene, camera)\n    }\n    loop()\n\n    const ro = new ResizeObserver(([entry]) => {\n      const { width, height } = entry.contentRect\n      if (width === 0 || height === 0) return\n      camera.aspect = width / height\n      camera.updateProjectionMatrix()\n      renderer.setSize(width, height)\n    })\n    ro.observe(el)\n\n    return () => {\n      cancelAnimationFrame(rafRef.current)\n      ro.disconnect()\n      controls.dispose()\n      renderer.dispose()\n      if (el.contains(renderer.domElement)) el.removeChild(renderer.domElement)\n      sceneRef.current = null\n      cameraRef.current = null\n      rendererRef.current = null\n      controlsRef.current = null\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // =======================================================================\n  // EFFECT 2  Build meshes\n  // =======================================================================\n  useEffect(() => {\n    const scene = sceneRef.current\n    if (!scene) return\n\n    for (const m of meshesRef.current) {\n      scene.remove(m)\n      if (ownedGeomsRef.current.has(m.geometry)) { m.geometry.dispose(); ownedGeomsRef.current.delete(m.geometry) }\n      const mat = m.material\n      if (Array.isArray(mat)) mat.forEach((mt) => mt.dispose())\n      else mat.dispose()\n    }\n    meshesRef.current = []\n    slotOrderRef.current.clear()\n\n    try {\n      const slots = slotsRef.current\n      const clr = color\n      const newMeshes: THREE.Mesh[] = []\n      const newSlotOrder = new Map<number, number[]>()\n\n      if (filteredGeometries.length > 0) {\n        for (let fi = 0; fi < filteredGeometries.length; fi++) {\n          const geom = filteredGeometries[fi]\n          if (!geom) continue\n          const oi = originalIndices[fi] ?? fi\n\n          if (isMultiColor && slots.length > 1) {\n            const triMap = triangleMaterialMaps?.get(oi)\n            if (triMap && triMap.size > 0) {\n              const uniq = new Set(triMap.values())\n              if (uniq.size > 1) {\n                const result = buildMultiMaterialGeometry(geom, triMap, slots)\n                if (result) {\n                  ownedGeomsRef.current.add(result.geometry)\n                  const mesh = new THREE.Mesh(result.geometry, result.materials)\n                  newSlotOrder.set(newMeshes.length, result.slotOrder)\n                  newMeshes.push(mesh)\n                  continue\n                }\n              }\n              const hex = [...uniq][0]\n              const si = slots.findIndex((s) => s.id === hex)\n              const slot = si >= 0 ? slots[si] : null\n              const mesh = new THREE.Mesh(geom, makeMaterial(colorToHex(slot?.selectedColor ?? hex)))\n              if (si >= 0) newSlotOrder.set(newMeshes.length, [si])\n              newMeshes.push(mesh)\n              continue\n            }\n\n            const geomSlots = slots.map((s, i) => ({ s, i })).filter(({ s }) => s.objectIds.includes(oi))\n            if (geomSlots.length > 0) {\n              const { s: slot, i: si } = geomSlots[0]\n              const mesh = new THREE.Mesh(geom, makeMaterial(colorToHex(slot.selectedColor)))\n              newSlotOrder.set(newMeshes.length, [si])\n              newMeshes.push(mesh)\n              continue\n            }\n          }\n\n          newMeshes.push(new THREE.Mesh(geom, makeMaterial(colorToHex(clr))))\n        }\n\n        meshesRef.current = newMeshes\n        slotOrderRef.current = newSlotOrder\n        centerAndScale(newMeshes, scene)\n      }\n\n      setDebugInfo(\n        isMultiColor && slots.length > 1\n          ? `${slots.length} colors, ${newMeshes.length} mesh(es)`\n          : `${newMeshes.length} mesh(es)`,\n      )\n    } catch (e) {\n      console.error('[Viewer] render error', e)\n      setDebugInfo(`ERROR: ${e instanceof Error ? e.message : 'unknown'}`)\n    }\n\n    const currentMeshes = meshesRef.current\n    const currentOwnedGeoms = ownedGeomsRef.current\n    return () => {\n      for (const m of currentMeshes) {\n        scene.remove(m)\n        if (currentOwnedGeoms.has(m.geometry)) { m.geometry.dispose(); currentOwnedGeoms.delete(m.geometry) }\n        const mat = m.material\n        if (Array.isArray(mat)) mat.forEach((mt) => mt.dispose())\n        else mat.dispose()\n      }\n      meshesRef.current = []\n      slotOrderRef.current.clear()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [filteredGeometries, originalIndices, isMultiColor, materialSlots.length, triangleMaterialMaps, selectedPlateId])\n\n  // =======================================================================\n  // EFFECT 3  Lightweight colour update\n  // =======================================================================\n  useEffect(() => {\n    if (meshesRef.current.length === 0) return\n\n    for (const [mi, order] of slotOrderRef.current) {\n      const mesh = meshesRef.current[mi]\n      if (!mesh) continue\n      const mat = mesh.material\n      if (Array.isArray(mat) && order.length === mat.length) {\n        for (let gi = 0; gi < order.length; gi++) {\n          const slot = materialSlots[order[gi]]\n          if (slot && mat[gi]) (mat[gi] as THREE.MeshPhongMaterial).color.setHex(colorToHex(slot.selectedColor))\n        }\n      } else if (order.length === 1) {\n        const slot = materialSlots[order[0]]\n        if (slot) {\n          ;((Array.isArray(mat) ? mat[0] : mat) as THREE.MeshPhongMaterial).color.setHex(\n            colorToHex(slot.selectedColor),\n          )\n        }\n      }\n    }\n\n    if (!isMultiColor) {\n      for (const m of meshesRef.current) {\n        const mat = m.material\n        if (!Array.isArray(mat)) (mat as THREE.MeshPhongMaterial).color.setHex(colorToHex(color))\n      }\n    }\n  }, [materialSlots, color, isMultiColor])\n\n  // -----------------------------------------------------------------------\n  // Styles\n  // -----------------------------------------------------------------------\n  const containerStyle: React.CSSProperties = {\n    width: '100%',\n    height: '100%',\n    borderRadius: 8,\n    border: `1px solid ${theme.border}`,\n    overflow: 'hidden',\n    position: 'relative',\n    ...style,\n  }\n\n  const overlayStyle: React.CSSProperties = {\n    position: 'absolute',\n    inset: 0,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    zIndex: 10,\n    background: 'rgba(15,23,42,0.5)',\n  }\n\n  const showLoading = loading || (!model && !error && geometries.length === 0)\n\n  return (\n    <div ref={containerRef} className={className} style={containerStyle}>\n      {showLoading && (\n        <div style={overlayStyle}>\n          <div\n            style={{\n              width: '100%',\n              height: '100%',\n              background: theme.surface,\n              animation: 'pulse 2s ease-in-out infinite',\n              borderRadius: 8,\n            }}\n          />\n        </div>\n      )}\n      {error && (\n        <div style={overlayStyle}>\n          <div style={{ textAlign: 'center', padding: 32 }}>\n            <p style={{ color: '#ef4444', marginBottom: 8 }}>Failed to render model</p>\n            <p style={{ fontSize: 12, color: theme.textMuted }}>{error.message}</p>\n          </div>\n        </div>\n      )}\n      {showDebugOverlay && isMultiColor && materialSlots.length > 1 && (\n        <div\n          style={{\n            position: 'absolute',\n            top: 8,\n            left: 8,\n            zIndex: 20,\n            background: 'rgba(0,0,0,0.7)',\n            borderRadius: 6,\n            padding: '4px 8px',\n            fontSize: 11,\n            fontFamily: theme.fontFamily,\n            color: '#4ade80',\n            pointerEvents: 'none',\n            maxWidth: 200,\n          }}\n        >\n          <div> {materialSlots.length} colors</div>\n          <div style={{ display: 'flex', gap: 3, marginTop: 4, flexWrap: 'wrap' }}>\n            {materialSlots.map((s, i) => (\n              <div\n                key={i}\n                style={{\n                  width: 12,\n                  height: 12,\n                  borderRadius: 2,\n                  border: '1px solid rgba(255,255,255,0.3)',\n                  backgroundColor: s.selectedColor.startsWith('#') ? s.selectedColor : undefined,\n                }}\n                title={`${s.name}: ${s.selectedColor}`}\n              />\n            ))}\n          </div>\n          {debugInfo && (\n            <div style={{ marginTop: 4, fontSize: 9, color: 'rgba(74,222,128,0.6)', whiteSpace: 'pre-wrap' }}>\n              {debugInfo}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n","import { useThreeMF } from './context'\nimport type { ColorOption, ViewerTheme } from '../core/types'\nimport { resolveTheme, colorToCss, DEFAULT_COLOR_OPTIONS } from '../styles/theme'\n\nexport interface ColorPickerProps {\n  /** Available named colours. Falls back to built-in defaults. */\n  colorOptions?: ColorOption[]\n  /** Theme overrides. */\n  theme?: ViewerTheme\n  /** CSS class for the root element. */\n  className?: string\n  /** Inline styles for the root element. */\n  style?: React.CSSProperties\n}\n\n/**\n * Colour picker for each material slot.\n *\n * Only renders when the model has multiple colours detected.\n * Must be used inside a `<ThreeMFProvider>`.\n */\nexport function ColorPicker({ colorOptions, theme: themeOverrides, className, style }: ColorPickerProps) {\n  const { isMultiColor, materialSlots, setSlotColor } = useThreeMF()\n  const theme = resolveTheme(themeOverrides)\n  const colors = colorOptions ?? DEFAULT_COLOR_OPTIONS\n\n  if (!isMultiColor || materialSlots.length === 0) return null\n\n  const rootStyle: React.CSSProperties = {\n    background: `${theme.surface}33`,\n    borderRadius: 8,\n    padding: 12,\n    border: `1px solid ${theme.border}`,\n    fontFamily: theme.fontFamily,\n    ...style,\n  }\n\n  return (\n    <div className={className} style={rootStyle}>\n      <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12 }}>\n        <svg width={16} height={16} viewBox=\"0 0 24 24\" fill=\"none\" stroke={theme.accent} strokeWidth={2}>\n          <path\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            d=\"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01\"\n          />\n        </svg>\n        <span style={{ fontSize: 12, fontWeight: 500, color: theme.textMuted }}>Multi-color</span>\n      </div>\n\n      <p style={{ fontSize: 11, color: theme.textMuted, marginBottom: 12 }}>\n        {materialSlots.length} filament{materialSlots.length !== 1 ? 's' : ''}  select colors:\n      </p>\n\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n        {materialSlots.map((slot, index) => {\n          const isHexColor = slot.selectedColor.startsWith('#')\n          const originalColorHex = slot.id.startsWith('#') ? slot.id : null\n\n          return (\n            <div\n              key={slot.id}\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                padding: '6px 8px',\n                borderRadius: 6,\n                background: `${theme.surface}80`,\n                border: `1px solid ${theme.surface}`,\n              }}\n            >\n              {originalColorHex && (\n                <div\n                  style={{\n                    width: 16,\n                    height: 16,\n                    borderRadius: 3,\n                    border: `1px solid ${theme.textMuted}`,\n                    backgroundColor: originalColorHex,\n                    flexShrink: 0,\n                  }}\n                  title={`Original: ${originalColorHex}`}\n                />\n              )}\n              <span\n                style={{\n                  fontSize: 11,\n                  color: theme.textMuted,\n                  flexShrink: 0,\n                  width: 80,\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                  whiteSpace: 'nowrap',\n                }}\n                title={slot.name || `Slot ${index + 1}`}\n              >\n                {slot.name || `Filament ${index + 1}`}\n              </span>\n              <div style={{ flex: 1, display: 'flex', alignItems: 'center', gap: 8, minWidth: 0 }}>\n                <div\n                  style={{\n                    width: 20,\n                    height: 20,\n                    borderRadius: 4,\n                    border: `1px solid ${theme.surface}`,\n                    backgroundColor: colorToCss(slot.selectedColor),\n                    flexShrink: 0,\n                  }}\n                  title={slot.selectedColor}\n                />\n                <select\n                  value={slot.selectedColor}\n                  onChange={(e) => setSlotColor(slot.id, e.target.value)}\n                  style={{\n                    flex: 1,\n                    minWidth: 0,\n                    padding: '6px 8px',\n                    fontSize: 11,\n                    borderRadius: 4,\n                    background: theme.background,\n                    border: `1px solid ${theme.surface}`,\n                    color: theme.text,\n                    outline: 'none',\n                    cursor: 'pointer',\n                  }}\n                >\n                  {isHexColor && <option value={slot.selectedColor}>Original ({slot.selectedColor})</option>}\n                  {colors.map((c) => (\n                    <option key={c.name} value={c.name}>\n                      {c.name}\n                    </option>\n                  ))}\n                </select>\n              </div>\n            </div>\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n","import { useThreeMF } from './context'\nimport type { ViewerTheme } from '../core/types'\nimport { resolveTheme } from '../styles/theme'\n\nexport interface PlateSelectorProps {\n  /** Theme overrides. */\n  theme?: ViewerTheme\n  /** CSS class for the root element. */\n  className?: string\n  /** Inline styles for the root element. */\n  style?: React.CSSProperties\n}\n\n/**\n * Plate selector dropdown.\n *\n * Only renders when the model has multiple plates.\n * Must be used inside a `<ThreeMFProvider>`.\n */\nexport function PlateSelector({ theme: themeOverrides, className, style }: PlateSelectorProps) {\n  const { plates, selectedPlateId, selectPlate } = useThreeMF()\n  const theme = resolveTheme(themeOverrides)\n\n  if (!plates || plates.length <= 1) return null\n\n  return (\n    <div className={className} style={{ fontFamily: theme.fontFamily, ...style }}>\n      <label\n        style={{\n          display: 'block',\n          fontSize: 12,\n          fontWeight: 500,\n          color: theme.textMuted,\n          marginBottom: 8,\n        }}\n      >\n        Plate\n      </label>\n      <select\n        value={selectedPlateId ?? ''}\n        onChange={(e) => selectPlate(e.target.value ? parseInt(e.target.value) : null)}\n        style={{\n          width: '100%',\n          padding: '10px 12px',\n          borderRadius: 8,\n          background: theme.background,\n          border: `1px solid ${theme.border}`,\n          color: theme.text,\n          fontSize: 13,\n          outline: 'none',\n          cursor: 'pointer',\n        }}\n      >\n        {plates.map((plate) => (\n          <option key={plate.id} value={plate.id}>\n            {plate.name} ({plate.objectIds.length} object{plate.objectIds.length !== 1 ? 's' : ''})\n          </option>\n        ))}\n      </select>\n      {selectedPlateId && (\n        <p style={{ fontSize: 11, color: theme.textMuted, marginTop: 8 }}>\n          Showing objects from {plates.find((p) => p.id === selectedPlateId)?.name}\n        </p>\n      )}\n    </div>\n  )\n}\n","import { useState } from 'react'\nimport { useThreeMF } from './context'\nimport type { ColorOption, ViewerTheme } from '../core/types'\nimport { resolveTheme } from '../styles/theme'\n\nexport interface SaveButtonProps {\n  /** Theme overrides. */\n  theme?: ViewerTheme\n  /** Color options to resolve named colors. */\n  colorOptions?: ColorOption[]\n  /** Custom filename (without extension). */\n  filename?: string\n  /** CSS class for the root element. */\n  className?: string\n  /** Inline styles for the root element. */\n  style?: React.CSSProperties\n}\n\n/**\n * Save/download button for the modified 3MF file.\n *\n * Shows a download button that exports the current color selections\n * back into the .3MF file.\n *\n * Must be used inside a `<ThreeMFProvider>`.\n */\nexport function SaveButton({\n  theme: themeOverrides,\n  colorOptions,\n  filename,\n  className,\n  style,\n}: SaveButtonProps) {\n  const { model, originalFile, exporting, downloadFile, hasColorChanges } = useThreeMF()\n  const theme = resolveTheme(themeOverrides)\n  const [saved, setSaved] = useState(false)\n\n  if (!model || !originalFile) return null\n\n  const handleClick = async () => {\n    setSaved(false)\n    await downloadFile(filename, colorOptions)\n    setSaved(true)\n    setTimeout(() => setSaved(false), 2500)\n  }\n\n  const buttonStyle: React.CSSProperties = {\n    width: '100%',\n    padding: '10px 16px',\n    borderRadius: 8,\n    border: 'none',\n    cursor: exporting ? 'wait' : 'pointer',\n    fontFamily: theme.fontFamily,\n    fontSize: 13,\n    fontWeight: 600,\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    gap: 8,\n    transition: 'all 0.2s',\n    background: saved\n      ? '#22c55e'\n      : hasColorChanges\n        ? theme.accent\n        : `${theme.surface}`,\n    color: saved || hasColorChanges ? '#ffffff' : theme.text,\n    opacity: exporting ? 0.7 : 1,\n    ...style,\n  }\n\n  return (\n    <div className={className}>\n      <button\n        onClick={handleClick}\n        disabled={exporting}\n        style={buttonStyle}\n        title={hasColorChanges ? 'Download .3MF with your color changes' : 'Download .3MF file'}\n      >\n        {exporting ? (\n          <>\n            <Spinner color={hasColorChanges ? '#ffffff' : theme.textMuted} />\n            Exporting\n          </>\n        ) : saved ? (\n          <>\n            <svg width={16} height={16} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth={2.5}>\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M5 13l4 4L19 7\" />\n            </svg>\n            Saved!\n          </>\n        ) : (\n          <>\n            <svg width={16} height={16} viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth={2}>\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\"\n              />\n            </svg>\n            {hasColorChanges ? 'Save Modified .3MF' : 'Download .3MF'}\n          </>\n        )}\n      </button>\n      {hasColorChanges && !saved && !exporting && (\n        <p\n          style={{\n            fontSize: 10,\n            color: theme.textMuted,\n            marginTop: 6,\n            textAlign: 'center',\n          }}\n        >\n          Colors changed  save to apply\n        </p>\n      )}\n    </div>\n  )\n}\n\n// Small inline spinner\nfunction Spinner({ color }: { color: string }) {\n  return (\n    <svg\n      width={16}\n      height={16}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      style={{ animation: 'spin 1s linear infinite' }}\n    >\n      <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>\n      <circle cx={12} cy={12} r={10} stroke={color} strokeWidth={3} opacity={0.25} />\n      <path\n        d=\"M12 2a10 10 0 019.95 9\"\n        stroke={color}\n        strokeWidth={3}\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  )\n}\n","import { useEffect, useRef, useState } from 'react'\nimport { ThreeMFProvider, useThreeMF } from './context'\nimport { Viewer } from './Viewer'\nimport { ColorPicker } from './ColorPicker'\nimport { PlateSelector } from './PlateSelector'\nimport { SaveButton } from './SaveButton'\nimport type { ThreeMFViewerProps } from '../core/types'\nimport { resolveTheme } from '../styles/theme'\n\n// ---------------------------------------------------------------------------\n// Inner component (needs context)\n// ---------------------------------------------------------------------------\n\nfunction WorkbenchInner({\n  file,\n  colorOptions,\n  theme: themeOverrides,\n  showSaveButton = true,\n  className,\n  style,\n}: ThreeMFViewerProps) {\n  const { loadFile, model } = useThreeMF()\n  const theme = resolveTheme(themeOverrides)\n  const prevFileRef = useRef<File | null>(null)\n\n  useEffect(() => {\n    if (file && file !== prevFileRef.current) {\n      prevFileRef.current = file\n      loadFile(file)\n    }\n  }, [file, loadFile])\n\n  const rootStyle: React.CSSProperties = {\n    display: 'flex',\n    gap: 16,\n    width: '100%',\n    height: '100%',\n    fontFamily: theme.fontFamily,\n    ...style,\n  }\n\n  return (\n    <div className={className} style={rootStyle}>\n      {/* 3D Viewport */}\n      <div style={{ flex: 1, minHeight: 300 }}>\n        <Viewer theme={themeOverrides} showDebugOverlay />\n      </div>\n\n      {/* Sidebar */}\n      {model && (\n        <div\n          style={{\n            width: 260,\n            display: 'flex',\n            flexDirection: 'column',\n            gap: 16,\n            flexShrink: 0,\n          }}\n        >\n          <PlateSelector theme={themeOverrides} />\n          <ColorPicker theme={themeOverrides} colorOptions={colorOptions} />\n          {showSaveButton && <SaveButton theme={themeOverrides} colorOptions={colorOptions} />}\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ---------------------------------------------------------------------------\n// Public all-in-one component\n// ---------------------------------------------------------------------------\n\n/**\n * All-in-one 3MF viewer: viewport + plate selector + colour picker + save button.\n *\n * Wraps its own `<ThreeMFProvider>`  no extra setup needed.\n *\n * @example\n * ```tsx\n * import { ThreeMFWorkbench } from 'parse3mf'\n *\n * function App() {\n *   const [file, setFile] = useState<File | null>(null)\n *   return (\n *     <>\n *       <input type=\"file\" onChange={e => setFile(e.target.files?.[0] ?? null)} />\n *       <ThreeMFWorkbench file={file} />\n *     </>\n *   )\n * }\n * ```\n */\nexport function ThreeMFWorkbench(props: ThreeMFViewerProps) {\n  return (\n    <ThreeMFProvider\n      onParsed={props.onParsed}\n      onError={props.onError}\n      onSlotColorChange={props.onSlotColorChange}\n      onPlateChange={props.onPlateChange}\n      onExported={props.onExported}\n    >\n      <WorkbenchInner {...props} />\n    </ThreeMFProvider>\n  )\n}\n"]}